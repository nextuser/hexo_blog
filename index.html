<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>nextuser&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="正在学习move, sui,walrus">
<meta property="og:type" content="website">
<meta property="og:title" content="nextuser&#39;s blog">
<meta property="og:url" content="http://www.walrus.mov/index.html">
<meta property="og:site_name" content="nextuser&#39;s blog">
<meta property="og:description" content="正在学习move, sui,walrus">
<meta property="og:locale">
<meta property="article:author" content="nextuser">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="nextuser's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="css/style.css">

  
    
<link rel="stylesheet" href="fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="index.html" id="logo">nextuser&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="index.html" id="subtitle">科学减肥</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Buscar"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Buscar"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.walrus.mov"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-sui/sui witness" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/23/sui/sui%20witness/" class="article-date">
  <time class="dt-published" datetime="2024-11-23T01:26:19.374Z" itemprop="datePublished">2024-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="move-语言中的witness-模式"><a href="#move-语言中的witness-模式" class="headerlink" title="move 语言中的witness 模式,"></a>move 语言中的witness 模式,</h1><h2 id="witnes-的例子解释"><a href="#witnes-的例子解释" class="headerlink" title="witnes 的例子解释"></a>witnes 的例子解释</h2><p>hoh社区中 uvd 对这个模式使用了一个比较有趣的类比.比如要建房子,</p>
<ul>
<li>建房子需要找政府申请建房许可.</li>
</ul>
<ul>
<li>建好房子之后,这个建房许可就会被销毁</li>
</ul>
<p><img src="images/image-20241123093733016.png" alt="image-20241123093733016"></p>
<h2 id="witness合约代码"><a href="#witness合约代码" class="headerlink" title="witness合约代码:"></a>witness合约代码:</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> book::witness;</span><br><span class="line">use sui::coin::&#123;Self,Coin&#125;;</span><br><span class="line">use sui::sui::SUI;</span><br><span class="line">use std::string::&#123;Self,String&#125;;</span><br><span class="line"><span class="type">const</span> PASSPORT_FEE:u64 = <span class="number">50000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">ShareInfo</span> has key&#123;</span><br><span class="line">    id :UID,</span><br><span class="line">    owner:address,</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function">fun <span class="title">init</span><span class="params">(ctx:&amp;mut TxContext)</span></span>&#123;</span><br><span class="line">    let share_info = ShareInfo&#123;</span><br><span class="line">        id:object::<span class="built_in">new</span>(ctx),</span><br><span class="line">        owner:ctx.<span class="built_in">sender</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    transfer::<span class="built_in">freeze_object</span>(share_info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">House</span> has key&#123;</span><br><span class="line">    id:UID,</span><br><span class="line">    name:String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Passport</span> has drop&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 花钱购买一个Passport</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">requirePassport</span><span class="params">(mut c:Coin&lt;SUI&gt;,share_info: &amp;ShareInfo, ctx : &amp;mut TxContext)</span> : Passport&#123;</span></span><br><span class="line">    <span class="comment">//分割出来收费</span></span><br><span class="line">    let fee = coin::<span class="built_in">split</span>(&amp;mut c, PASSPORT_FEE, ctx);</span><br><span class="line">    transfer::<span class="built_in">public_transfer</span>(fee,share_info.owner);</span><br><span class="line">    <span class="comment">//归还找零的钱</span></span><br><span class="line">    transfer::<span class="built_in">public_transfer</span>(c,ctx.<span class="built_in">sender</span>());</span><br><span class="line">    <span class="comment">//返回Passport</span></span><br><span class="line">    Passport&#123;&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">///获得Passport 才能创建House , Passport 每次使用之后都会消耗掉</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">create_house</span><span class="params">(_:Passport, name:String, ctx:&amp;mut TxContext)</span></span>&#123;</span><br><span class="line">    let house = House&#123;</span><br><span class="line">        id:object::<span class="built_in">new</span>(ctx),</span><br><span class="line">        name:name,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//转让房子给交易发起者</span></span><br><span class="line">    transfer::<span class="built_in">transfer</span>(house,ctx.<span class="built_in">sender</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 为了在模块外测试代码调用init函数</span></span><br><span class="line">#[test_only]</span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">test_init</span><span class="params">(ctx:&amp;mut TxContext)</span></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">///为了模块外测试代码获取本模块常量, 因为常量不是public的</span></span><br><span class="line">#[test_only]</span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">get_passport_fee</span><span class="params">()</span>:u64&#123;</span></span><br><span class="line">    PASSPORT_FEE</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h2 id="单元测试代码"><a href="#单元测试代码" class="headerlink" title="单元测试代码"></a>单元测试代码</h2><p>我们提供两个测试用例</p>
<ul>
<li>测试获取passport, 测试创建房子  test_witness_flow</li>
<li>测试获取passport,因为金额不够失败 test_witness_flow_no_enough</li>
</ul>
<p>相关测试代码的使用了test_scenario 模拟合约的多次调用,校验合约的效果( coin的转让 ,对象的转让)</p>
<p>相关使用可以参考 <a target="_blank" rel="noopener" href="https://learnblockchain.cn/article/8066">https://learnblockchain.cn/article/8066</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">#[test_only]</span><br><span class="line"><span class="keyword">module</span> book::witness_tests ;</span><br><span class="line">use sui::test_scenario::&#123;Self, Scenario&#125;;</span><br><span class="line">use sui::coin::&#123;Self, Coin&#125;;</span><br><span class="line">use sui::sui::SUI;</span><br><span class="line">use std::string;</span><br><span class="line">use book::witness::&#123;Self, ShareInfo, House, Passport&#125;;</span><br><span class="line">use book::witness::get_passport_fee;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line"><span class="function">fun <span class="title">test_witness_flow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    let owner = @<span class="number">0xA</span>;</span><br><span class="line">    let user = @<span class="number">0xB</span>;</span><br><span class="line">    <span class="comment">// 第一步：初始化场景</span></span><br><span class="line">    let mut scenario = test_scenario::<span class="built_in">begin</span>(owner);    </span><br><span class="line">    <span class="comment">// 初始化合约,创建 ShareInfo</span></span><br><span class="line">    test_scenario::<span class="built_in">next_tx</span>(&amp;mut scenario, owner);</span><br><span class="line">    &#123;</span><br><span class="line">        witness::<span class="built_in">test_init</span>(test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户购买 Passport</span></span><br><span class="line">    test_scenario::<span class="built_in">next_tx</span>(&amp;mut scenario, user);</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建测试用的 SUI coin</span></span><br><span class="line">        let coin = coin::<span class="built_in">mint_for_testing</span>&lt;SUI&gt;(<span class="number">100000</span>, test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario));</span><br><span class="line">        let share_info = test_scenario::<span class="built_in">take_immutable</span>&lt;ShareInfo&gt;(&amp;scenario);</span><br><span class="line">        </span><br><span class="line">        let passport = witness::<span class="built_in">requirePassport</span>(</span><br><span class="line">            coin,</span><br><span class="line">            &amp;share_info,</span><br><span class="line">            test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 Passport 创建 House</span></span><br><span class="line">        witness::<span class="built_in">create_house</span>(</span><br><span class="line">            passport,</span><br><span class="line">            string::<span class="built_in">utf8</span>(b<span class="string">&quot;My House&quot;</span>),</span><br><span class="line">            test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        test_scenario::<span class="built_in">return_immutable</span>(share_info);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证 House 是否创建成功</span></span><br><span class="line">    test_scenario::<span class="built_in">next_tx</span>(&amp;mut scenario, user);</span><br><span class="line">    &#123;</span><br><span class="line">        let coin = test_scenario::take_from_address&lt;Coin&lt;SUI&gt;&gt;(&amp;scenario, owner);</span><br><span class="line">        assert!(coin.<span class="built_in">value</span>() == <span class="built_in">get_passport_fee</span>());</span><br><span class="line">        test_scenario::<span class="built_in">return_to_address</span>(owner, coin);</span><br><span class="line"></span><br><span class="line">        let coin = test_scenario::take_from_address&lt;Coin&lt;SUI&gt;&gt;(&amp;scenario, user);</span><br><span class="line">        assert!(coin.<span class="built_in">value</span>() == <span class="number">100000</span> - <span class="built_in">get_passport_fee</span>());</span><br><span class="line">        test_scenario::<span class="built_in">return_to_address</span>(user, coin);</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        assert!(test_scenario::<span class="built_in">has_most_recent_for_sender</span>&lt;House&gt;(&amp;scenario));</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    test_scenario::<span class="built_in">end</span>(scenario);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">#[<span class="built_in">expected_failure</span>(abort_code = sui::balance::ENotEnough)]</span><br><span class="line"><span class="function">fun <span class="title">test_witness_flow_no_enough</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    let owner = @<span class="number">0xA</span>;</span><br><span class="line">    let user = @<span class="number">0xB</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第一步：初始化场景</span></span><br><span class="line">    let mut scenario = test_scenario::<span class="built_in">begin</span>(owner);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化合约,创建 ShareInfo</span></span><br><span class="line">    test_scenario::<span class="built_in">next_tx</span>(&amp;mut scenario, owner);</span><br><span class="line">    &#123;</span><br><span class="line">        witness::<span class="built_in">test_init</span>(test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户购买 Passport</span></span><br><span class="line">    test_scenario::<span class="built_in">next_tx</span>(&amp;mut scenario, user);</span><br><span class="line">    &#123;</span><br><span class="line">        let fee = <span class="built_in">get_passport_fee</span>() - <span class="number">1</span>;</span><br><span class="line">        let coin = coin::<span class="built_in">mint_for_testing</span>&lt;SUI&gt;(fee, test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario));</span><br><span class="line">        let share_info = test_scenario::<span class="built_in">take_immutable</span>&lt;ShareInfo&gt;(&amp;scenario);</span><br><span class="line">        <span class="comment">//这里会因为fee 不够而失败</span></span><br><span class="line">        let passport = witness::<span class="built_in">requirePassport</span>(</span><br><span class="line">            coin,</span><br><span class="line">            &amp;share_info,</span><br><span class="line">            test_scenario::<span class="built_in">ctx</span>(&amp;mut scenario)</span><br><span class="line">        );</span><br><span class="line">        test_scenario::<span class="built_in">return_shared</span>(share_info);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    test_scenario::<span class="built_in">end</span>(scenario);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关代码在:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nextuser/move-examples">https://github.com/nextuser/move-examples</a></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>最近在参见HOH社区的学习</p>
<p>💧 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/d0brr-ao6cZ5t8Z5OO1Mog">HOH水分子公众号</a></p>
<p>🌊 <a target="_blank" rel="noopener" href="https://x.com/0xHOH">HOH水分子X账号</a></p>
<p>📹 <a target="_blank" rel="noopener" href="https://space.bilibili.com/3493269495352098">课程B站账号</a></p>
<p>💻 Github仓库 <a target="_blank" rel="noopener" href="https://github.com/move-cn/letsmove">https://github.com/move-cn/letsmove</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/23/sui/sui%20witness/" data-id="cm3tiu6f00000lvo3d6g644mh" data-title="" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-walrus/walrus-first" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/19/walrus/walrus-first/" class="article-date">
  <time class="dt-published" datetime="2024-11-19T03:37:09.759Z" itemprop="datePublished">2024-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>参考资料：</p>
<ul>
<li>（sui warus 教程）[<a target="_blank" rel="noopener" href="https://letswalrus.vercel.app/docs/arch/encode]">https://letswalrus.vercel.app/docs/arch/encode]</a></li>
</ul>
<ul>
<li>install</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:MystenLabs/walrus-sites.git</span><br></pre></td></tr></table></figure>








      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/19/walrus/walrus-first/" data-id="cm3nwlqw800015wo37f0006mm" data-title="" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hexo-install-tips" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/19/hexo-install-tips/" class="article-date">
  <time class="dt-published" datetime="2024-11-18T16:08:11.000Z" itemprop="datePublished">2024-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/hexo/">hexo</a>►<a class="article-category-link" href="categories/hexo/dns/">dns</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/19/hexo-install-tips/">使用hexo搭建个人主页</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="目标"><a href="#目标" class="headerlink" title="目标:"></a>目标:</h1><p>搭建个人网站, 不购买服务器, 搭建个人 blog.</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤:"></a>步骤:</h2><ul>
<li>购买域名 , 本例从porkbun.com 购买了域名walrus.mov</li>
<li>不买服务器,直接使用github page功能</li>
</ul>
<ol>
<li><p>安装hexo ,hexo是一个博客管理工具,</p>
</li>
<li><p>将hexo 管理的网页发布到一个github project中</p>
</li>
<li><p>将 github project 配置成github page<br> 获得 nextuser.github.io 网站, 配置github page 的域名为<a href="http://www.walrus.mov/">www.walrus.mov</a></p>
</li>
</ol>
<p>  刚开始是不会校验通过的.</p>
<ol start="4">
<li>配置购买的dns 地址 ,关联到github 网站. (这一步配置好后,第3步才会配置成功)</li>
</ol>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npmg i -g hexo</span><br></pre></td></tr></table></figure>

<h2 id="初始化目录"><a href="#初始化目录" class="headerlink" title="初始化目录"></a>初始化目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo init  blog</span><br></pre></td></tr></table></figure>

<ul>
<li><p>问题 ..&#x2F;..&#x2F;..&#x2F;package.json: No license field</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access <span class="string">&#x27;https://github.com/hexojs/hexo-starter.git/&#x27;</span>: GnuTLS recv error (-110): The TLS connection was non-properly terminated.</span><br><span class="line">WARN  git <span class="built_in">clone</span> failed. Copying data instead</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">warning ../../../package.json: No license field</span><br><span class="line">error Error: certificate has expired</span><br><span class="line">    at TLSSocket.onConnectSecure (node:_tls_wrap:1539:34)</span><br><span class="line">    at TLSSocket.emit (node:events:513:28)</span><br><span class="line">    at TLSSocket._finishInit (node:_tls_wrap:953:8)</span><br><span class="line">    at TLSWrap.ssl.onhandshakedone (node:_tls_wrap:734:12)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>对策</p>
<ul>
<li>修改package.json,增加license 描述</li>
<li>执行 npm install</li>
</ul>
</li>
</ul>
<figure class="highlight json"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  # package.json</span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo-site&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="执行编译和开启服务"><a href="#执行编译和开启服务" class="headerlink" title="执行编译和开启服务"></a>执行编译和开启服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx hexo g</span><br><span class="line">npx hexo s</span><br></pre></td></tr></table></figure>
<p>可以在 localhost:4000查看页面</p>
<h2 id="发布到git"><a href="#发布到git" class="headerlink" title="发布到git"></a>发布到git</h2><h3 id="修改-config-yml-配置和git关联"><a href="#修改-config-yml-配置和git关联" class="headerlink" title="修改_config.yml 配置和git关联"></a>修改_config.yml 配置和git关联</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:nextuser/hexo_blog.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>
<h3 id="安装配套插件"><a href="#安装配套插件" class="headerlink" title="安装配套插件"></a>安装配套插件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -save hexo-deployer-git</span><br></pre></td></tr></table></figure>
<h3 id="执行部署deploy命令"><a href="#执行部署deploy命令" class="headerlink" title="执行部署deploy命令"></a>执行部署deploy命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo d</span><br></pre></td></tr></table></figure>
<p>会将public目录的文件提交到github执行的项目目录下.</p>
<h2 id="在github-project-settings-配置github-page"><a href="#在github-project-settings-配置github-page" class="headerlink" title="在github project-&gt;settings  配置github page"></a>在github project-&gt;settings  配置github page</h2><p><img src="/images/image-20241118232126863.png" alt="image-20241118232126863"></p>
<h2 id="配置-dns-github"><a href="#配置-dns-github" class="headerlink" title="配置 dns &#x3D;&gt; github"></a>配置 dns &#x3D;&gt; github</h2><p>在porkbun.com 配置我的dns域名和github的关联关系: dns 和github page关联</p>
<ul>
<li><p>进入域名管理</p>
<p><img src="/images/image-20241118232306366.png" alt="image-20241118232306366"></p>
</li>
</ul>
<p>编辑 dns record</p>
<ul>
<li><p>dns 关联到github</p>
<p><img src="/images/image-20241118232507380.png" alt="image-20241118232507380"></p>
</li>
<li><p>设置 dns和github 地址的对应关系</p>
<p><img src="/images/image-20241118232644409.png" alt="image-20241118232644409"></p>
</li>
<li><p>需要下载  CNAME 文件放到 blog&#x2F;public 目录中</p>
</li>
</ul>
<h1 id="日常编写博客使用步骤"><a href="#日常编写博客使用步骤" class="headerlink" title="日常编写博客使用步骤"></a>日常编写博客使用步骤</h1><ol>
<li><p>使用typora 或vs code ,在  source&#x2F;_posts 目录下建立markdown日记文件</p>
</li>
<li><p>编写完毕之后,执行生成日记功能</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo g</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>打开服务,测试 (可选，如果服务已经打开，不需要执行此服务)</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo s</span><br></pre></td></tr></table></figure>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:4000/">http://localhost:4000</a> 查看网页是否正常</p>
<ol start="4">
<li>部署到github</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo d</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>访问我定制的网站  <a href="http://www.walrus.mov/">www.walrus.mov</a></li>
</ol>
<ul>
<li>问题 ： markdown 文件引用的 _post&#x2F;images 文件不会拷贝到public，会导致图片不能正常显示。<ul>
<li>据说_config.yml 配置如下<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>下载如下插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image --save</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/19/hexo-install-tips/" data-id="cm3n5gh0h00007bo3bkref0du" data-title="使用hexo搭建个人主页" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/blog/" rel="tag">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/dns/" rel="tag">dns</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/github-page/" rel="tag">github page</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/18/hello-world/" class="article-date">
  <time class="dt-published" datetime="2024-11-18T14:06:03.187Z" itemprop="datePublished">2024-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/18/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/18/hello-world/" data-id="cm3n3pkf600003qo3ctkzfxz9" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-sui/sui-colearn-qa1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/11/sui/sui-colearn-qa1/" class="article-date">
  <time class="dt-published" datetime="2024-11-11T13:47:08.000Z" itemprop="datePublished">2024-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/sui/">sui</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/11/sui/sui-colearn-qa1/">2024 -11-11  第一周Sui Move训练营课程答疑问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>2024 -11-11  第一周Sui Move训练营课程答疑问题</p>
<h3 id="1-github-下载问题-编译时不能访问github路径"><a href="#1-github-下载问题-编译时不能访问github路径" class="headerlink" title="1 github 下载问题,编译时不能访问github路径"></a>1 github 下载问题,编译时不能访问github路径</h3><p><img src="images/77cab47def96df0bfa0bc2000f6533c.png" alt="77cab47def96df0bfa0bc2000f6533c"></p>
<ul>
<li>对策:</li>
</ul>
<p>修改Move.toml 中的github成gitee</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dependencies]</span><br><span class="line">#Sui = &#123; git = &quot;https://github.com/MystenLabs/sui.git&quot;, subdir = &quot;crates/sui-framework/packages/sui-framework&quot;, rev = &quot;framework/testnet&quot; &#125;</span><br><span class="line">Sui = &#123; git = &quot;https://gitee.com/MystenLabs/sui.git&quot;, subdir = &quot;crates/sui-framework/packages/sui-framework&quot;, rev = &quot;framework/testnet&quot; &#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-git-pull-pull不下来，报错过早文件结束"><a href="#2-git-pull-pull不下来，报错过早文件结束" class="headerlink" title="2  git pull pull不下来，报错过早文件结束"></a>2  git pull pull不下来，报错过早文件结束</h3><h4 id="2-1-如果是-github下载问题-更换是gitee"><a href="#2-1-如果是-github下载问题-更换是gitee" class="headerlink" title="2.1 如果是 github下载问题,更换是gitee"></a>2.1 如果是 github下载问题,更换是gitee</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[dependencies]</span><br><span class="line">#Sui = &#123; git = &quot;https://github.com/MystenLabs/sui.git&quot;, subdir = &quot;crates/sui-framework/packages/sui-framework&quot;, rev = &quot;framework/testnet&quot; &#125;</span><br><span class="line">Sui = &#123; git = &quot;https://gitee.com/MystenLabs/sui.git&quot;, subdir = &quot;crates/sui-framework/packages/sui-framework&quot;, rev = &quot;framework/testnet&quot; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-gitee下载存在问题"><a href="#2-2-gitee下载存在问题" class="headerlink" title="2.2  gitee下载存在问题"></a>2.2  gitee下载存在问题</h4><ul>
<li><p>对策:  </p>
<ul>
<li><p>windows: 使用git bash  执行以下命令,将代码下载到本地</p>
</li>
<li><p>采用 ssh 下载</p>
<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@gitee.com:mystenLabs/sui.git</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>方法一 :代码可以使用百度网盘下载</p>
<p>提取码task</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://pan.baidu.com/s/1LQwwlPz6Q2DVAod-DhD1UA</span><br></pre></td></tr></table></figure>

<p><img src="images/image-20241111124128818.png" alt="image-20241111124128818"></p>
<p>解压到本地路径</p>
<ul>
<li>linux如下命令</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/sui-local</span><br><span class="line"><span class="built_in">cd</span> ~/sui-local</span><br><span class="line">git <span class="built_in">clone</span> git@gitee.com:mystenLabs/sui.git</span><br><span class="line">git checkout framework/testnet</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure>



<h4 id="2-3-修改-Move-toml-sui框架依赖本地代码"><a href="#2-3-修改-Move-toml-sui框架依赖本地代码" class="headerlink" title="2.3 修改 Move.toml ,sui框架依赖本地代码"></a>2.3 修改 Move.toml ,sui框架依赖本地代码</h4><ul>
<li><p>确定 用户的主目录</p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ljl@ljl-i5-14400:~/work/sui/demo/table_example$ <span class="built_in">cd</span> ~</span><br><span class="line">ljl@ljl-i5-14400:~$ <span class="built_in">pwd</span></span><br><span class="line">/home/ljl</span><br></pre></td></tr></table></figure>


</li>
<li><p>例子中的&#x2F;home&#x2F;ljl 是我的主目录,你可以更换成你下载的sui 代码路径</p>
</li>
</ul>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="comment">#Sui = &#123; git = &quot;https://gitee.com/MystenLabs/sui.git&quot;, subdir = &quot;crates/sui-framework/packages/sui-framework&quot;, rev = &quot;framework/testnet&quot; &#125;</span></span><br><span class="line"><span class="attr">Sui</span> = &#123;local=<span class="string">&quot;/home/ljl/sui-local/sui/crates/sui-framework/packages/sui-framework&quot;</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="问题3-每次编译都提示-fail-to-resolve-dependencies-问题"><a href="#问题3-每次编译都提示-fail-to-resolve-dependencies-问题" class="headerlink" title="问题3. 每次编译都提示, fail to resolve dependencies 问题"></a>问题3. 每次编译都提示, fail to resolve dependencies 问题</h3><p><img src="images/eee52dccc6c1235a42e6b2025f3accc.png" alt="eee52dccc6c1235a42e6b2025f3accc"></p>
<h4 id="3-1-原因"><a href="#3-1-原因" class="headerlink" title="3.1 原因"></a>3.1 原因</h4><p>github网络访问比较困难</p>
<h4 id="3-2-对策"><a href="#3-2-对策" class="headerlink" title="3.2 对策"></a>3.2 对策</h4><ul>
<li>方法1 修改工程</li>
</ul>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Move.toml</span></span><br><span class="line">[dependencies]</span><br><span class="line">Sui = &#123; git = <span class="string">&quot;https://gitee.com/MystenLabs/sui.git&quot;</span>, subdir = <span class="string">&quot;crates/sui-framework/packages/sui-framework&quot;</span>, rev = <span class="string">&quot;framework/testnet&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法2  </p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui move --skip-fetch-latest-git-deps  build</span><br></pre></td></tr></table></figure>



<p>可以写一个suib的脚本, 后续执行 suib即可</p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ljl@ljl-i5-14400:~/work/sui/demo/bb$ <span class="built_in">cat</span> /usr/bin/suib</span><br><span class="line">sui move build --skip-fetch-latest-git-deps</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-publish-失败的原因-不能找到-clien-server-api-version-mismatch"><a href="#4-publish-失败的原因-不能找到-clien-server-api-version-mismatch" class="headerlink" title="4 publish 失败的原因, 不能找到 clien&#x2F;server api version mismatch"></a>4 publish 失败的原因, 不能找到 clien&#x2F;server api version mismatch</h3><p><img src="images/b751b6d5fe797767bdc15617707d711.jpg" alt="b751b6d5fe797767bdc15617707d711"></p>
<p>这个是因为sui client的版本比较老,testnet已经是1.37.1</p>
<ul>
<li>方法一</li>
</ul>
<p>应该是安装的sui 二进制文件版本比较老,需要从服务器下载更新的sui 二进制文件  </p>
<p> <a target="_blank" rel="noopener" href="https://github.com/MystenLabs/sui/releases/tag/testnet-v1.37.1">https://github.com/MystenLabs/sui/releases/tag/testnet-v1.37.1</a></p>
<p>也有可能是 gitee上的代码比较老, 需要更换Move.toml中dependencies 的以来路径</p>
<ul>
<li>方法二</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sui client publish --skip-dependency-verification</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="5-publish问题-没有找到Move-toml-unable-to-find-package-manifest"><a href="#5-publish问题-没有找到Move-toml-unable-to-find-package-manifest" class="headerlink" title="5. publish问题:没有找到Move.toml (unable to find package manifest)"></a>5. publish问题:没有找到Move.toml (unable to find package manifest)</h3><p><img src="images/4c9df0a037a48da78f174af4c63b80a.jpg" alt="4c9df0a037a48da78f174af4c63b80a"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\work\sui&gt;sui client publish</span><br><span class="line">Unable to find package manifest at <span class="string">&#x27;\\?\D:\work\sui/Move.toml&#x27;</span> or <span class="keyword">in</span> its parents</span><br></pre></td></tr></table></figure>

<p><img src="images/image-20241109195541791.png" alt="image-20241109195541791"></p>
<h4 id="5-1-原因"><a href="#5-1-原因" class="headerlink" title="5.1 原因"></a>5.1 原因</h4><p>这是因为当前路径没有找到Move.toml 文件, 因为没有cd 到项目代码中.</p>
<p>如下图,  sui move new 新建项目目录之后,需要cd 到项目目录里面</p>
<p><img src="images/image-20241109194128504.png" alt="image-20241109194128504"></p>
<p>参见上图中步骤,第三部需要cd 创建的项目的目录, sui move build 会在当前目录查找Move.toml</p>
<h3 id="6-pubish-失败-没有gas"><a href="#6-pubish-失败-没有gas" class="headerlink" title="6. pubish 失败,没有gas"></a>6. pubish 失败,没有gas</h3><h4 id="6-1-publish失败-gas不足"><a href="#6-1-publish失败-gas不足" class="headerlink" title="6.1 publish失败,gas不足"></a>6.1 publish失败,gas不足</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\work\sui\task1&gt;sui client balance</span><br><span class="line">No coins found for this address.</span><br><span class="line"></span><br><span class="line">D:\work\sui\task1&gt;sui client faucet</span><br><span class="line">Request successful. It can take up to 1 minute to get the coin. Run sui client gas to check your gas coins.</span><br><span class="line"></span><br><span class="line">D:\work\sui\task1&gt;sui client balance</span><br><span class="line">╭────────────────────────────────────────╮</span><br><span class="line">│ Balance of coins owned by this address │</span><br><span class="line">├────────────────────────────────────────┤</span><br><span class="line">│ ╭─────────────────────────────────╮    │</span><br><span class="line">│ │ coin  balance (raw)  balance    │    │</span><br><span class="line">│ ├─────────────────────────────────┤    │</span><br><span class="line">│ │ Sui   1000000000     1.00 SUI   │    │</span><br><span class="line">│ ╰─────────────────────────────────╯    │</span><br><span class="line">╰────────────────────────────────────────╯</span><br></pre></td></tr></table></figure>



<h3 id="7-提示-需要-–gas-budget"><a href="#7-提示-需要-–gas-budget" class="headerlink" title="7. 提示 需要 –gas-budget"></a>7. 提示 需要 –gas-budget</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not automatically determine the gas budget. Please supply one using the --gas-budget flag.</span><br></pre></td></tr></table></figure>



<p><img src="images/8983d211b2b1dceaf57ffe22183c955.png" alt="8983d211b2b1dceaf57ffe22183c955"></p>
<h4 id="对策-提供-gas-budget-参数"><a href="#对策-提供-gas-budget-参数" class="headerlink" title="对策:提供 gas-budget 参数"></a>对策:提供 gas-budget 参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui client publish --gas-budget 40000000</span><br></pre></td></tr></table></figure>



<h3 id="8-提问预编译的下载包如何使用"><a href="#8-提问预编译的下载包如何使用" class="headerlink" title="8 .提问预编译的下载包如何使用"></a>8 .提问预编译的下载包如何使用</h3><h3 id="8-1-下载sui-编译包"><a href="#8-1-下载sui-编译包" class="headerlink" title="8.1  下载sui  编译包"></a>8.1  下载sui  编译包</h3><p>目前的sui 预编译下载包,在</p>
<p><a target="_blank" rel="noopener" href="https://github.com/MystenLabs/sui/releases">https://github.com/MystenLabs/sui/releases</a></p>
<p>根据不同操作系统,下载对应的包, 下载之后,需要解压文件</p>
<h3 id="8-2-环境变量设置"><a href="#8-2-环境变量设置" class="headerlink" title="8.2 环境变量设置"></a>8.2 环境变量设置</h3><h5 id="8-2-1-windows-的解压和path变量设置"><a href="#8-2-1-windows-的解压和path变量设置" class="headerlink" title="8.2.1 windows 的解压和path变量设置"></a>8.2.1 windows 的解压和path变量设置</h5><p>windows 使用 7-zip能解压到比如 d:\app\sui 文件目录</p>
<p><img src="images/image-20241110213627080.png" alt="image-20241110213627080"></p>
<p><img src="images/image-20241110213815476.png" alt="image-20241110213815476"></p>
<p>需要在windows设置path </p>
<p><img src="images/image-20241110214212301.png" alt="image-20241110214212301"></p>
<p><img src="images/image-20241110214031742.png" alt="image-20241110214031742"></p>
<h5 id="8-2-2-linux的解压和path-变量设置"><a href="#8-2-2-linux的解压和path-变量设置" class="headerlink" title="8.2.2 linux的解压和path 变量设置"></a>8.2.2 linux的解压和path 变量设置</h5><h6 id="8-2-2-1-linux-下载文件后解压"><a href="#8-2-2-1-linux-下载文件后解压" class="headerlink" title="8.2.2.1 linux 下载文件后解压"></a>8.2.2.1 linux 下载文件后解压</h6><p>下载文件到 ~&#x2F; 目录 ,下面的代码将 tgz 文件解压到sui 目录, 如果你需要</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ljl@ljl-i5-14400:~$ <span class="built_in">ls</span> *.tgz</span><br><span class="line">sui-testnet-v1.36.2-ubuntu-x86_64.tgz  sui-testnet-v1.37.1-ubuntu-x86_64.tgz</span><br><span class="line">ljl@ljl-i5-14400:~$ <span class="built_in">mkdir</span> sui</span><br><span class="line">ljl@ljl-i5-14400:~$ <span class="built_in">cd</span> sui</span><br><span class="line">ljl@ljl-i5-14400:~/sui$ tar xzf ../sui-testnet-v1.37.1-ubuntu-x86_64.tgz</span><br><span class="line">ljl@ljl-i5-14400:~/sui$ <span class="built_in">ls</span></span><br><span class="line">move-analyzer  sui-bridge      sui-data-ingestion  sui-faucet       sui-node            sui-tool</span><br><span class="line">sui            sui-bridge-cli  sui-debug           sui-graphql-rpc  sui-test-validator</span><br><span class="line">ljl@ljl-i5-14400:~/sui$ <span class="built_in">pwd</span></span><br><span class="line">/home/ljl/sui</span><br></pre></td></tr></table></figure>

<ul>
<li><p>注意$ 之前的是命令行提示</p>
</li>
<li><p>最后的pwd看到的目录和你本人用户主目录有关.</p>
<h6 id="8-2-2-2-设置-path"><a href="#8-2-2-2-设置-path" class="headerlink" title="8.2.2.2 设置 path"></a>8.2.2.2 设置 path</h6></li>
</ul>
<ul>
<li><p>可以修改&#x2F;etc&#x2F;profile 或 ~&#x2F;.bashrc 文件的尾部,增加一行</p>
</li>
<li><p>注意你将&#x2F;home&#x2F;ljl&#x2F;sui 修改成你的sui 解压的路径</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/home/ljl/sui</span><br></pre></td></tr></table></figure>

<ul>
<li>执行 source  ~&#x2F;.bashrc</li>
</ul>
<h5 id="8-2-3-mac环境变量设置"><a href="#8-2-3-mac环境变量设置" class="headerlink" title="8.2.3  mac环境变量设置"></a>8.2.3  mac环境变量设置</h5><h6 id="mac-的安装类似linux-最后路径设置需要配置在-etc-profile"><a href="#mac-的安装类似linux-最后路径设置需要配置在-etc-profile" class="headerlink" title="mac 的安装类似linux, 最后路径设置需要配置在 &#x2F;etc&#x2F;profile"></a>mac 的安装类似linux, 最后路径设置需要配置在 &#x2F;etc&#x2F;profile</h6><h1 id><a href="#" class="headerlink" title></a></h1><h3 id="9-otw-有什么用"><a href="#9-otw-有什么用" class="headerlink" title="9 otw 有什么用"></a>9 otw 有什么用</h3><ul>
<li>问题: 见证者对象有什么作用，我在好几个地方看到，只知道怎么用，不知道为什么要这么写</li>
</ul>
<p>otw 在coin发币的时候用得很多,  因为otw对象智能由package构造,   </p>
<p>而参与增加货币相关的方法,都是由一个<T> 参数,这个类型参数是一个OTW参数.   使用OTW 类型做泛型的对象,</T></p>
<p>只在OTW 模块初始化的时候才能创建,以后都无法创建. One time witness </p>
<p>注意</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="title class_">Balance</span>&lt;T&gt;&#123;&#125;</span><br><span class="line">struct <span class="title class_">Supply</span>&lt;T&gt;&#123;&#125;</span><br><span class="line">struct <span class="title class_">Coin</span>&lt;T&gt;&#123;&#125;</span><br><span class="line">struct <span class="title class_">TreasureCap</span>&lt;T&gt;&#123;&#125;</span><br><span class="line"><span class="comment">/// unique instance of CoinMetadata&lt;T&gt; that stores the metadata for this coin type.</span></span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">CoinMetadata</span>&lt;phantom T&gt; has key, store &#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"><span class="variable language_">module</span> <span class="attr">pkg</span>::hk&#123;</span><br><span class="line">    <span class="keyword">public</span> struct <span class="variable constant_">HK</span> has drop &#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">init</span>(<span class="params"><span class="attr">hk</span>:&amp;mut HK, <span class="attr">ctx</span>:mut <span class="title class_">TxContext</span></span>)&#123;</span><br><span class="line">        <span class="title function_">let</span> (cap,meta) = <span class="attr">coin</span>::<span class="title function_">create_currency</span>(hk,&amp;mut ctx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>创建的货币沾染了一个T, 这个T  是一个OTW  struct, 无法创建,无法在外部使用</p>
<p><img src="images/image-20241111221059544.png" alt="image-20241111221059544"></p>
<p><img src="images/image-20241111221218590.png" alt="image-20241111221218590"></p>
<ul>
<li><p>supply对象提供了增长货币余额balance的方法,  </p>
</li>
<li><p>balance可以转换成coin. </p>
</li>
<li><p>sui::balance::create_supply 是最关键的创建货币的方法</p>
</li>
<li><p>sui::balance::create_supply 需要一个otw对象做参数.</p>
</li>
</ul>
<p> create_supply 需要一个otw对象.  创建货币 需要Balance,创建Balance 需要Supply, 创建Supply 需要一个otw对象hk</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sui::balance;</span><br><span class="line"><span class="keyword">public</span> fun balance::<span class="built_in">create_supply</span>&lt;T: drop&gt;(_: T): Supply&lt;T&gt; &#123;</span><br><span class="line">    Supply &#123; value: <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> fun <span class="built_in">increase_supply</span>&lt;T&gt;(self: &amp;mut Supply&lt;T&gt;, value: u64): Balance&lt;T&gt; &#123;</span><br><span class="line">    assert!(value &lt; (<span class="number">18446744073709551615u</span>64 - self.value), EOverflow);</span><br><span class="line">    self.value = self.value + value;</span><br><span class="line">    Balance &#123; value &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>sui::balance 这个Supply 和Balance 都需要一个OTW类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public struct Supply&lt;phantom T&gt; has store &#123;</span><br><span class="line">    value: u64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/// Storable balance - an inner struct of a Coin type.</span><br><span class="line">/// Can be used to store coins which don&#x27;t need the key ability.</span><br><span class="line">public struct Balance&lt;phantom T&gt; has store &#123;</span><br><span class="line">    value: u64,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sui::coin 也有一个type arg 需要一个OTW 类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/// A coin of type `T` worth `value`. Transferable and storable</span><br><span class="line">public struct Coin&lt;phantom T&gt; has key, store &#123;</span><br><span class="line">    id: UID,</span><br><span class="line">    balance: Balance&lt;T&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 我们创建货币之后,查看到的TreasuryCap,持有一个Supply对象,因此持有了增长货币的能力.</p>
<p><img src="images/image-20241111110333165.png" alt="image-20241111110333165"></p>
<p>货币创建,如下图中的HK 不能手工创建,后面创建的货币,都使用HK 类型参数</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span> <span class="attr">coin_owner</span>::hk &#123;</span><br><span class="line">    use <span class="attr">sui</span>::<span class="attr">coin</span>::create_currency;</span><br><span class="line">    use <span class="attr">sui</span>::<span class="attr">tx_context</span>::&#123;<span class="title class_">TxContext</span>, sender&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> struct <span class="variable constant_">HK</span> has drop &#123;&#125;</span><br><span class="line"></span><br><span class="line">    fun <span class="title function_">init</span>(<span class="params"><span class="attr">hk</span>: HK, <span class="attr">ctx</span>: &amp;mut <span class="title class_">TxContext</span></span>) &#123;</span><br><span class="line">        <span class="title function_">let</span> (treasury_cap, coin_metadata) =</span><br><span class="line">            <span class="title function_">create_currency</span>(</span><br><span class="line">            hk,</span><br><span class="line">            <span class="number">8</span>,</span><br><span class="line">            b<span class="string">&quot;HK&quot;</span>,</span><br><span class="line">            b<span class="string">&quot;HK  made in hongkong&quot;</span>,</span><br><span class="line">            b<span class="string">&quot;HK  made in hongkong&quot;</span>,</span><br><span class="line">            <span class="attr">option</span>::<span class="title function_">none</span>(),</span><br><span class="line">            ctx);</span><br><span class="line">        <span class="attr">transfer</span>::<span class="title function_">public_freeze_object</span>(coin_metadata);</span><br><span class="line">        <span class="keyword">let</span> my_address = <span class="title function_">sender</span>(ctx);</span><br><span class="line">        <span class="attr">transfer</span>::<span class="title function_">public_transfer</span>(treasury_cap, my_address)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>货币创建方法 coin::create_currency, 里面需要第一个参数 witness是 One time witness</p>
<p><img src="images/image-20241111114413049.png" alt="image-20241111114413049"></p>
<p>以下推论:</p>
<ol>
<li><p>定义货币的package publish之后,获得对象id ,成为pkg_id</p>
</li>
<li><p>publish的时候,临时创建了一个 pkg_id::hk::HK struct的对象</p>
</li>
<li><p>coin::create_currency  创建出来了 </p>
<p><code>Supply&lt;pkg_id::hk::HK&gt; </code> 对象<br>这个对象能生成 <code>Balance&lt;pkg_id::hk::HK&gt;</code> 对象<br>能生成 <code>Coin&lt;pkg_id::hk::HK&gt;</code></p>
</li>
</ol>
<p> 4 .只有持有<code>Supply&lt;pkg_id::hk::HK&gt;</code> 对象才能发币, 以后无法手工创建<code>Supply&lt;pkg_id::hk::HK&gt;</code> 对象,因为</p>
<p><code>public fun balance::create_supply&lt;T: drop&gt;(_: T): Supply&lt;T&gt;</code>  需要一个pkg_id::hk::HK 类型的对象做输入参数, package发布之后,无法通过编程创建.</p>
<ol start="5">
<li><p>TreasuryCap 只是Supply 对象的一种链上存储形式. </p>
</li>
<li><p>coin::create_currency 需要一个otw 对象, 这个方法才提供了CoinMetadata,才能当做真正的货币.</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> fun create_currency&lt;<span class="attr">T</span>: drop&gt;(</span><br><span class="line">    <span class="attr">witness</span>: T,</span><br><span class="line">    <span class="attr">decimals</span>: u8,</span><br><span class="line">    <span class="attr">symbol</span>: vector&lt;u8&gt;,</span><br><span class="line">    <span class="attr">name</span>: vector&lt;u8&gt;,</span><br><span class="line">    <span class="attr">description</span>: vector&lt;u8&gt;,</span><br><span class="line">    <span class="attr">icon_url</span>: <span class="title class_">Option</span>&lt;<span class="title class_">Url</span>&gt;,</span><br><span class="line">    <span class="attr">ctx</span>: &amp;mut <span class="title class_">TxContext</span>,</span><br><span class="line">): (<span class="title class_">TreasuryCap</span>&lt;T&gt;, <span class="title class_">CoinMetadata</span>&lt;T&gt;) &#123;</span><br><span class="line">    <span class="comment">// Make sure there&#x27;s only one instance of the type T</span></span><br><span class="line">    assert!(<span class="attr">sui</span>::<span class="attr">types</span>::<span class="title function_">is_one_time_witness</span>(&amp;witness), <span class="title class_">EBadWitness</span>);</span><br><span class="line"></span><br><span class="line">    (</span><br><span class="line">        <span class="title class_">TreasuryCap</span> &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="attr">object</span>::<span class="title function_">new</span>(ctx),</span><br><span class="line">            <span class="attr">total_supply</span>: <span class="attr">balance</span>::<span class="title function_">create_supply</span>(witness),</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title class_">CoinMetadata</span> &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="attr">object</span>::<span class="title function_">new</span>(ctx),</span><br><span class="line">            decimals,</span><br><span class="line">            <span class="attr">name</span>: <span class="attr">string</span>::<span class="title function_">utf8</span>(name),</span><br><span class="line">            <span class="attr">symbol</span>: <span class="attr">ascii</span>::<span class="title function_">string</span>(<span class="built_in">symbol</span>),</span><br><span class="line">            <span class="attr">description</span>: <span class="attr">string</span>::<span class="title function_">utf8</span>(description),</span><br><span class="line">            icon_url,</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>虽然也可以用balance::createSupply创建其他类型的balance 和coin,但是会当做其他对象看待.</p>
<p>下文中不使用otw创建的Supply,可以用来创建balance和coin.</p>
<p>不同用户都可以调用这个mint_to 方法. 创建出来的coin 不能视为代币,使用 sui client balance   不能看到.  因为没有对应的CoinMetadata</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span> <span class="attr">strange_coin</span>::jp;</span><br><span class="line">use <span class="attr">sui</span>::<span class="attr">balance</span>::&#123;<span class="title class_">Supply</span>,<span class="title class_">Balance</span>&#125;;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Other</span> has drop&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">SupplyHold</span> has key,store&#123;</span><br><span class="line">    id : <span class="variable constant_">UID</span>,</span><br><span class="line">    supply :<span class="title class_">Supply</span>&lt;<span class="title class_">Other</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> entry fun <span class="title function_">mint_to</span>(<span class="params">amount :u64,<span class="attr">to</span>:address,ctx : &amp;mut <span class="title class_">TxContext</span></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> other = <span class="title class_">Other</span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> mut supply = <span class="attr">sui</span>::<span class="attr">balance</span>::<span class="title function_">create_supply</span>(other);</span><br><span class="line">    <span class="keyword">let</span> balance = supply.<span class="title function_">increase_supply</span>(amount);</span><br><span class="line">    <span class="keyword">let</span> coin = <span class="attr">sui</span>::<span class="attr">coin</span>::<span class="title function_">from_balance</span>(balance, ctx);</span><br><span class="line">    <span class="keyword">let</span> hold = <span class="title class_">SupplyHold</span>&#123;</span><br><span class="line">        id : <span class="attr">object</span>::<span class="title function_">new</span>(ctx),</span><br><span class="line">        supply,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">public_transfer</span>(hold,<span class="attr">tx_context</span>::<span class="title function_">sender</span>(ctx));</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">public_transfer</span>(coin,to);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="10-move-table-对象的链上查看问题"><a href="#10-move-table-对象的链上查看问题" class="headerlink" title="10. move table 对象的链上查看问题"></a>10. move table 对象的链上查看问题</h3><ul>
<li>问题查看</li>
</ul>
<p>move 中 Table 是通过 dynamic field 实现的，在浏览器中似乎没有办法查到 table 中所有的数据，table 对应的那个 object id 在sui浏览器中也无法访问。只是浏览器不支持，还是说不能实现在链下查到 table 里所有的数据。</p>
<ul>
<li><p>答复,可以看到动态字段</p>
<h4 id="10-1-直接保存的table对象"><a href="#10-1-直接保存的table对象" class="headerlink" title="10.1  直接保存的table对象"></a>10.1  直接保存的table对象</h4><ul>
<li>相关代码</li>
</ul>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span> <span class="attr">table_example</span>::table_example;</span><br><span class="line">use <span class="attr">sui</span>::<span class="attr">table</span>::&#123;<span class="title class_">Self</span>,<span class="title class_">Table</span>&#125;;</span><br><span class="line">use <span class="attr">std</span>::<span class="attr">string</span>::<span class="title class_">String</span>;</span><br><span class="line"></span><br><span class="line">fun <span class="title function_">init</span>(<span class="params">ctx : &amp;mut <span class="title class_">TxContext</span></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> mut tb =  <span class="attr">table</span>::<span class="keyword">new</span>&lt;<span class="title class_">String</span>,u32&gt;(ctx);</span><br><span class="line">    tb.<span class="title function_">add</span>(b<span class="string">&quot;abc&quot;</span>.<span class="title function_">to_string</span>(),<span class="number">1</span>);</span><br><span class="line">    tb.<span class="title function_">add</span>(b<span class="string">&quot;def&quot;</span>.<span class="title function_">to_string</span>(),<span class="number">2</span>);</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">public_transfer</span>(tb,<span class="attr">tx_context</span>::<span class="title function_">sender</span>(ctx));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>查看publish上去的对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui client publish --skip-fetch-latest-git-deps  </span><br></pre></td></tr></table></figure>

<p>相关log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">╭──────────────────────────────────────────────────────────────────────────────────────────────────╮</span><br><span class="line">│ Object Changes                                                                                   │</span><br><span class="line">├──────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ Created Objects:                                                                                 │</span><br><span class="line">│  ┌──                                                                                             │</span><br><span class="line">│  │ ObjectID: 0x007c0c0b8d4139290a27523bd2645833853bfa12b6278573083abf9a8a6f8f5c                  │</span><br><span class="line">│  │ Sender: 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38                    │</span><br><span class="line">│  │ Owner: Object ID: ( 0x2e05841c8910b5450efc2744ad379a2986c73cd451fcac469833d0083ccacf9c )      │</span><br><span class="line">│  │ ObjectType: 0x2::dynamic_field::Field&lt;0x1::string::String, u32&gt;                               │</span><br><span class="line">│  │ Version: 206232477                                                                            │</span><br><span class="line">│  │ Digest: 3NMXpcaGLVMa81CPJmR6Da7pKB9xdksv3qTcQzwT3Bxb                                          │</span><br><span class="line">│  └──                                                                                             │</span><br><span class="line">│  ┌──                                                                                             │</span><br><span class="line">│  │ ObjectID: 0x2e05841c8910b5450efc2744ad379a2986c73cd451fcac469833d0083ccacf9c                  │</span><br><span class="line">│  │ Sender: 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38                    │</span><br><span class="line">│  │ Owner: Account Address ( 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38 ) │</span><br><span class="line">│  │ ObjectType: 0x2::table::Table&lt;0x1::string::String, u32&gt;                                       │</span><br><span class="line">│  │ Version: 206232477                                                                            │</span><br><span class="line">│  │ Digest: Ei39HsytUhDxrxWPX5uYohJ7CsSWbysxqvbTCEVKhZEf                                          │</span><br><span class="line">│  └──                                                  </span><br></pre></td></tr></table></figure>


</li>
<li><p>suiscan浏览</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://suiscan.xyz/testnet/object/0x2e05841c8910b5450efc2744ad379a2986c73cd451fcac469833d0083ccacf9c</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><img src="images/image-20241110234724177.png" alt="image-20241110234724177"></p>
<ul>
<li>相关字段</li>
</ul>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Adds a key-value pair to the table `table: &amp;mut Table&lt;K, V&gt;`</span></span><br><span class="line"><span class="comment">/// Aborts with `sui::dynamic_field::EFieldAlreadyExists` if the table already has an entry with</span></span><br><span class="line"><span class="comment">/// that key `k: K`.</span></span><br><span class="line"><span class="keyword">public</span> fun add&lt;<span class="attr">K</span>: copy + drop + store, <span class="attr">V</span>: store&gt;(<span class="attr">table</span>: &amp;mut <span class="title class_">Table</span>&lt;K, V&gt;, <span class="attr">k</span>: K, <span class="attr">v</span>: V) &#123;</span><br><span class="line">    <span class="attr">field</span>::<span class="title function_">add</span>(&amp;mut table.<span class="property">id</span>, k, v);</span><br><span class="line">    table.<span class="property">size</span> = table.<span class="property">size</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>dynamic field,  通过table address 和 属性名,一起计算字段.</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> fun add&lt;<span class="title class_">Name</span>: copy + drop + store, <span class="title class_">Value</span>: store&gt;(</span><br><span class="line">    <span class="comment">// we use &amp;mut UID in several spots for access control</span></span><br><span class="line">    <span class="attr">object</span>: &amp;mut <span class="variable constant_">UID</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Name</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="title class_">Value</span>,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">let</span> object_addr = <span class="built_in">object</span>.<span class="title function_">to_address</span>();</span><br><span class="line">    <span class="keyword">let</span> hash = <span class="title function_">hash_type_and_key</span>(object_addr, name);</span><br><span class="line">    assert!(!<span class="title function_">has_child_object</span>(object_addr, hash), <span class="title class_">EFieldAlreadyExists</span>);</span><br><span class="line">    <span class="keyword">let</span> field = <span class="title class_">Field</span> &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="attr">object</span>::<span class="title function_">new_uid_from_hash</span>(hash),</span><br><span class="line">        name,</span><br><span class="line">        value,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">add_child_object</span>(object_addr, field)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="table对象作为字段在-suivision-可以查看"><a href="#table对象作为字段在-suivision-可以查看" class="headerlink" title="table对象作为字段在 suivision 可以查看"></a>table对象作为字段在 suivision 可以查看</h4><p><a target="_blank" rel="noopener" href="https://testnet.suivision.xyz/object/0x0a6a64b85ce448afa134c0634487bdc7bb6d4f5a621237dc92e3f1671a2467fd">Sui Object</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://testnet.suivision.xyz/object/0x0a6a64b85ce448afa134c0634487bdc7bb6d4f5a621237dc92e3f1671a2467fd</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">struct</span> <span class="title">MyStore</span>  <span class="title">has</span> <span class="title">key</span> ,<span class="title">store</span>&#123;</span></span><br><span class="line">    id:UID,</span><br><span class="line">    total_balance : Balance&lt;SUI&gt;,</span><br><span class="line">    received: Table&lt;address,u64&gt; ,</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="images/image-20241111141423819.png" alt="image-20241111141423819"></p>
<p>相关对象定义:</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">MyStore</span>  has key ,store&#123;</span><br><span class="line">    <span class="attr">id</span>:<span class="variable constant_">UID</span>,</span><br><span class="line">    total_balance : <span class="title class_">Balance</span>&lt;<span class="variable constant_">SUI</span>&gt;,</span><br><span class="line">    <span class="attr">received</span>: <span class="title class_">Table</span>&lt;address,u64&gt; ,</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是相关动态字段的确看不到</p>
<h3 id="11-sui-钱包地址和client地址"><a href="#11-sui-钱包地址和client地址" class="headerlink" title="11 sui  钱包地址和client地址"></a>11 sui  钱包地址和client地址</h3><p>钱包地址与 sui 客户端地址的关系</p>
<ul>
<li><p>两个不同得地址，可以认为你有两个钱包，每个钱包有不同得密码， 一般大家采用帮助记忆的12个单词来记忆</p>
</li>
<li><p>可以做钱包A中的coin  转移 到钱包B</p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端钱包的地址，</span></span><br><span class="line"><span class="built_in">export</span>    C_ADDR=<span class="string">&quot;`sui client active-address`&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$C_ADDR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器钱包的地址，可以修改成你的钱包地址</span></span><br><span class="line"><span class="built_in">export</span> W_ADDR=0xafe36044ef56d22494bfe6231e78dd128f097693f2d974761ee4d649e61f5fa2</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$W_ADDR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以查到C_ADDR 的coin</span></span><br><span class="line">sui client gas <span class="variable">$C_ADDR</span></span><br><span class="line"></span><br><span class="line">ljl@ljl-i5-14400:~$ sui client gas <span class="variable">$C_ADDR</span></span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0xa957fcfae2a624189f4ee5e24d07be6f2e492668c8a8a3a810bb684c7ae25300 │ 3667910060         │ 3.66             │</span><br><span class="line">│ 0xb2fbb77f3168b61d21ac6c005086a1747ce451df29ade1be057c4eefcd17493b │ 1000000000         │ 1.00             │</span><br><span class="line">│ 0xda2e7328acd44f9167e306f18debf134f4200f9339241d904bc2bdd18266b00d │ 1000000000         │ 1.00             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br><span class="line"></span><br><span class="line">sui client balance <span class="variable">$W_ADDR</span></span><br><span class="line"><span class="comment"># 根据输出的gasCoinId 发送给W_ADDR</span></span><br><span class="line"><span class="built_in">export</span> COIN=0xda2e7328acd44f9167e306f18debf134f4200f9339241d904bc2bdd18266b00d</span><br><span class="line"></span><br><span class="line">sui client transfer --to <span class="variable">$W_ADDR</span> --object-id <span class="variable">$COIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看钱包中的coin</span></span><br><span class="line"></span><br><span class="line">sui client gas <span class="variable">$W_ADDR</span></span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x2cbbd85ae56bb9d95746797283a6ef045fdad20d76bfe5690097f6467f96693a │ 997666048          │ 0.99             │</span><br><span class="line">│ 0x761035a215b60f6d3c08dff837b85a67f1e2620ba63a0904785924d37095c201 │ 922766720          │ 0.92             │</span><br><span class="line">│ 0xda2e7328acd44f9167e306f18debf134f4200f9339241d904bc2bdd18266b00d │ 1000000000         │ 1.00             │</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sui client balance <span class="variable">$W_ADDR</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="我们每次做publish或move-call，都需要区块链网络计算和存储，这些计算和存储需要消耗gas值。"><a href="#我们每次做publish或move-call，都需要区块链网络计算和存储，这些计算和存储需要消耗gas值。" class="headerlink" title="我们每次做publish或move-call，都需要区块链网络计算和存储，这些计算和存储需要消耗gas值。"></a>我们每次做publish或move-call，都需要区块链网络计算和存储，这些计算和存储需要消耗gas值。</h3><p><img src="images/image-20241110231811470.png" alt="image-20241110231811470"></p>
<h3 id="12-查看当前支持的网络"><a href="#12-查看当前支持的网络" class="headerlink" title="12 查看当前支持的网络"></a>12 查看当前支持的网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> sui client envs</span><br><span class="line">╭─────────┬─────────────────────────────────────┬────────╮</span><br><span class="line">│ <span class="built_in">alias</span>   │ url                                 │ active │</span><br><span class="line">├─────────┼─────────────────────────────────────┼────────┤</span><br><span class="line">│ testnet │ https://fullnode.testnet.sui.io:443 │ *      │</span><br><span class="line">│ devnet  │ https://fullnode.devnet.sui.io:443  │        │</span><br><span class="line">│ <span class="built_in">local</span>   │ http://127.0.0.1:9000               │        │</span><br><span class="line">│ mainnet │ https://fullnode.mainnet.sui.io:443 │        │</span><br><span class="line">╰─────────┴─────────────────────────────────────┴────────╯</span><br></pre></td></tr></table></figure>



<p>配置网络devnet</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui client new-env --<span class="built_in">alias</span> devnet --rpc https://fullnode.devnet.sui.io:443</span><br></pre></td></tr></table></figure>



<p>如果没有devnet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui client switch --env  devnet</span><br></pre></td></tr></table></figure>



<h3 id="11-自动publish到了devnet上面，不知道怎么回事，scan上面在devnet上能搜到id，但是source-code显示不出"><a href="#11-自动publish到了devnet上面，不知道怎么回事，scan上面在devnet上能搜到id，但是source-code显示不出" class="headerlink" title="11 自动publish到了devnet上面，不知道怎么回事，scan上面在devnet上能搜到id，但是source code显示不出"></a>11 自动publish到了devnet上面，不知道怎么回事，scan上面在devnet上能搜到id，但是source code显示不出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#  查看当前的环境</span><br><span class="line">sui client envs</span><br><span class="line">╭─────────┬─────────────────────────────────────┬────────╮</span><br><span class="line">│ alias   │ url                                 │ active │</span><br><span class="line">├─────────┼─────────────────────────────────────┼────────┤</span><br><span class="line">│ testnet │ https://fullnode.testnet.sui.io:443 │        │</span><br><span class="line">│ devnet  │ https://fullnode.devnet.sui.io:443  │ *      │</span><br><span class="line">│ local   │ http://127.0.0.1:9000               │        │</span><br><span class="line">│ mainnet │ https://fullnode.mainnet.sui.io:443 │        │</span><br><span class="line">╰─────────┴─────────────────────────────────────┴────────╯</span><br><span class="line"># 带星号的是当前的环境</span><br><span class="line">sui client active-env</span><br><span class="line"># 切换环境到testnet</span><br><span class="line"> sui client switch --env  testnet</span><br><span class="line">Active environment switched to [testnet]</span><br></pre></td></tr></table></figure>



<h3 id="13-ability"><a href="#13-ability" class="headerlink" title="13  ability"></a>13  ability</h3><ul>
<li>问题: move的基础语法不熟悉，比如::是什么意思，drop、key这些都是什么含义等等，感觉可以边helloworld边讲解一下语法，每个词对应的意思，为什么需要这些</li>
</ul>
<p>参看 move-book.com ,可以使用浏览器翻译查看</p>
<h4 id="-1"><a href="#-1" class="headerlink" title></a></h4><p>对象的4中能力(abliity)</p>
<p>这四种能力是：</p>
<ul>
<li><p><code>copy</code></p>
<ul>
<li>允许复制具有此功能的类型的值。</li>
</ul>
</li>
<li><p><code>drop</code></p>
<ul>
<li>允许跳出作用域自动删除</li>
</ul>
</li>
<li><p><code>store</code></p>
<ul>
<li>允许具有此功能的类型的值存在于 链上中的值中。  存在sui 网络上的对象的字段</li>
<li>对于 Sui，控制对象内部可以存储哪些<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">数据。</a> 还控制哪些类型可以在其定义模块之外传</li>
</ul>
</li>
<li><p><code>key</code></p>
<ul>
<li><p>允许类型用作存储的 “key”。表面上，这意味着该值可以是 存储中的顶级价值;换句话说，它不需要包含在另一个值中，以 在仓库里。</p>
</li>
<li><p>对于 Sui，用于表示<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">对象</a>。</p>
</li>
</ul>
</li>
</ul>
<p>13.1 对象的几种存储状态:</p>
<h5 id="13-1-1-销毁"><a href="#13-1-1-销毁" class="headerlink" title="13.1.1 销毁:"></a>13.1.1 销毁:</h5><ul>
<li><p>离开作用域自动销毁,具有drop能力</p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">IgnoreMe</span> has drop&#123;</span><br><span class="line">    <span class="attr">a</span>:u32,</span><br><span class="line">    <span class="attr">b</span>:u32</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">test_ignore</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> im = <span class="title class_">IgnoreMe</span>&#123;<span class="attr">a</span>:<span class="number">3</span>,<span class="attr">b</span>:<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="title function_">print</span>(&amp;im);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上文定义的IgnoreMe 对象im 具有自动析构的能力<code>has drop</code>,在离开函数的作用域时候自动析构.</p>
</li>
<li><p>编码主动析构</p>
</li>
</ul>
 <figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">NoDrop</span>&#123; value :u64 &#125;</span><br><span class="line"></span><br><span class="line"> #[test]</span><br><span class="line"> fun <span class="title function_">test_nodrop</span>(<span class="params"></span>)&#123;</span><br><span class="line">     <span class="keyword">let</span> no_drop = <span class="title class_">NoDrop</span>&#123; value :<span class="number">34</span>&#125;;</span><br><span class="line">     <span class="title function_">print</span>(&amp;no_drop);</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">let</span> <span class="title class_">NoDrop</span>&#123; <span class="attr">value</span>: _ &#125; = no_drop;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这个例子 NoDrop类型没有drop能力,对象离开作用域,需要析构,或者将对象的所有权转移.</p>
<ul>
<li>第8行是析构对象的代码</li>
</ul>
<h5 id="13-1-2-转移"><a href="#13-1-2-转移" class="headerlink" title="13.1.2 转移:"></a>13.1.2 转移:</h5><h4 id="-2"><a href="#-2" class="headerlink" title></a></h4> <figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fun <span class="title function_">useNoDrop</span>(o : <span class="title class_">NoDrop</span> ) : <span class="title class_">NoDrop</span>&#123;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;o);</span><br><span class="line">    o</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">testUseNoDrop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> o = <span class="title class_">NoDrop</span>&#123;value :<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="title function_">useNoDrop</span>(o);</span><br><span class="line">    <span class="title class_">NoDrop</span>&#123;<span class="attr">value</span>:_&#125; = d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第1行函数UseNoDrop获得了对象o</li>
<li>第3行,函数将N哦Drop对象o 返回出去,将所有权转移出去.</li>
<li>第10 行,显示代码析构这个NoDrop对象</li>
</ul>
<h5 id="13-1-3-key-独立存储在链上"><a href="#13-1-3-key-独立存储在链上" class="headerlink" title="13.1.3  key:独立存储在链上:"></a>13.1.3  key:独立存储在链上:</h5><p>对象独立存储在链上,必须具有key能力 <code>has key</code></p>
<p><img src="images/image-20241114085958845.png" alt="image-20241114085958845"></p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">Keyable</span> has key&#123;</span><br><span class="line">    id : <span class="variable constant_">UID</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">test_key</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> mut ctx = tx_context ::<span class="title function_">dummy</span>();</span><br><span class="line">    <span class="keyword">let</span> k = <span class="title class_">Keyable</span>&#123; <span class="attr">id</span>: <span class="attr">object</span>::<span class="title function_">new</span>(&amp;mut ctx)&#125;;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;k);</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">transfer</span>(k,ctx.<span class="title function_">sender</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子中Keyable是具有key能力的,可以通过transfer传递到sui网络上存储, 指定owner地址.</p>
<h5 id="13-1-4-对象作为-共享对象存储在链上-需要具有key能力"><a href="#13-1-4-对象作为-共享对象存储在链上-需要具有key能力" class="headerlink" title="13.1.4  对象作为 共享对象存储在链上,需要具有key能力"></a>13.1.4  对象作为 共享对象存储在链上,需要具有key能力</h5><p><img src="images/image-20241114091033160.png" alt="image-20241114091033160"></p>
<h5 id="13-1-4-对象作为一个对象的一部分存储-需要具有store能力"><a href="#13-1-4-对象作为一个对象的一部分存储-需要具有store能力" class="headerlink" title="13.1.4 对象作为一个对象的一部分存储,需要具有store能力"></a>13.1.4 对象作为一个对象的一部分存储,需要具有store能力</h5><figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">use <span class="attr">std</span>::<span class="attr">string</span>::<span class="title class_">String</span>;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Grandson</span> has store&#123;</span><br><span class="line">    name : <span class="title class_">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Child</span> has store&#123;</span><br><span class="line">    name : <span class="title class_">String</span>,</span><br><span class="line">    child : <span class="title class_">Grandson</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Parent</span> has key&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="variable constant_">UID</span>,</span><br><span class="line">    <span class="attr">child</span>: <span class="title class_">Child</span>,</span><br><span class="line">&#125;</span><br><span class="line">#[test]</span><br><span class="line">fun  <span class="title function_">test_store_child</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> mut ctx = <span class="attr">tx_context</span>::<span class="title function_">dummy</span>();</span><br><span class="line">    <span class="keyword">let</span> foo = <span class="title class_">Parent</span> &#123;</span><br><span class="line">        id : <span class="attr">object</span>::<span class="title function_">new</span>(&amp;mut ctx),</span><br><span class="line">        <span class="attr">child</span>: <span class="title class_">Child</span> &#123;</span><br><span class="line">            name : b<span class="string">&quot;one child&quot;</span>.<span class="title function_">to_string</span>(),</span><br><span class="line">            <span class="attr">child</span>: <span class="title class_">Grandson</span>&#123;</span><br><span class="line">                name : b<span class="string">&quot;a grandson&quot;</span>.<span class="title function_">to_string</span>(),</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;foo);</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">freeze_object</span>(foo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Parent是独立存储,具有key能力</p>
</li>
<li><p>Child 都是作为独立存储对象Parent的字段</p>
</li>
<li><p>Grandson 作为Child的字段存储在链上,</p>
</li>
<li><p>Child 和Grandson 都具有store能力</p>
</li>
</ul>
<p><img src="images/image-20241114095326972.png" alt="image-20241114095326972"></p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ifadai/article/details/136046263">https://blog.csdn.net/ifadai/article/details/136046263</a><br><a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities.html">类型技能 - Move 参考</a></p>
<h4 id="13-2-四种能力"><a href="#13-2-四种能力" class="headerlink" title="13.2 四种能力"></a>13.2 <a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities.html#the-four-abilities">四种能力</a></h4><p>这四种能力是：</p>
<ul>
<li><p><code>copy</code></p>
<ul>
<li>允许复制具有此功能的类型的值。</li>
</ul>
</li>
<li><p><code>drop</code></p>
<ul>
<li>允许跳出作用域自动删除</li>
</ul>
</li>
<li><p><code>store</code></p>
<ul>
<li>允许具有此功能的类型的值存在于 链上中的值中。  存在sui 网络上的对象的字段</li>
<li>对于 Sui，控制对象内部可以存储哪些<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">数据。</a> 还控制哪些类型可以在其定义模块之外传</li>
</ul>
</li>
<li><p><code>key</code></p>
<ul>
<li><p>允许类型用作存储的 “key”。表面上，这意味着该值可以是 存储中的顶级价值;换句话说，它不需要包含在另一个值中，以 在仓库里。</p>
</li>
<li><p>对于 Sui，用于表示<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">对象</a>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="13-2-1-如果有copy能力-赋值就是拷贝成一个新对象"><a href="#13-2-1-如果有copy能力-赋值就是拷贝成一个新对象" class="headerlink" title="13.2.1 如果有copy能力,赋值就是拷贝成一个新对象"></a>13.2.1 如果有copy能力,赋值就是拷贝成一个新对象</h4><p><img src="images/image-20241111194804064.png" alt="image-20241111194804064"></p>
<ul>
<li><p>上图中27行,c对象被拷贝到d,c和d指向的不是同一个对象, </p>
</li>
<li><p>28 行修改了d,但是c没有被修改</p>
</li>
<li><p>32行和33行中,c和d取值不同.</p>
</li>
</ul>
<h4 id="13-2-如果没有copy-能力-赋值就是移动对象"><a href="#13-2-如果没有copy-能力-赋值就是移动对象" class="headerlink" title="13.2 如果没有copy 能力,赋值就是移动对象"></a>13.2 如果没有copy 能力,赋值就是移动对象</h4><p><img src="images/image-20241111194357890.png" alt="image-20241111194357890"></p>
<h4 id="13-3-如果没有ability-就必须在module内提供方法去析构它"><a href="#13-3-如果没有ability-就必须在module内提供方法去析构它" class="headerlink" title="13.3 如果没有ability,就必须在module内提供方法去析构它"></a>13.3 如果没有ability,就必须在module内提供方法去析构它</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="images/image-20241114080921239.png" alt="image-20241114080921239"></p>
<p><img src="images/image-20241111213310276.png" alt="image-20241111213310276"></p>
<ul>
<li>定义闪电贷的出借方,在borrow的时候获得Coin和 Loan对象,  </li>
<li>在repay的时候才能销毁Loan对象, 如果借出放不调用repay,无法销毁Loan对象,交易会回滚.</li>
<li>replay的时候需要校验传入的coin 要多于borrow的coin, 多出来的部分作为回报.<ul>
<li>下面是 贷方代码的例子</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> book::loan;</span><br><span class="line"><span class="comment">//hot potato pattern</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Loan</span>&#123;</span><br><span class="line">    feedback: u64, <span class="comment">//还钱数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Coin</span> has key,store&#123;</span><br><span class="line">	id:UID,</span><br><span class="line">	amount:u64</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//借出钱</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">borrow</span><span class="params">(amount:u64,ctx:&amp;mut TxContext)</span> :(Coin,Loan)&#123;</span></span><br><span class="line">	let feedback = amount * <span class="number">103</span> /<span class="number">100</span>;</span><br><span class="line">	let c = Coin&#123; id: object::<span class="built_in">new</span>(ctx),amount&#125;;</span><br><span class="line">	(c, Loan&#123;feedback&#125;) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> ErrNotEnoughFeedback:u64 = <span class="number">43</span>;</span><br><span class="line"><span class="type">const</span> OWNER_ADDR :address = @<span class="number">0xafe36044ef56d22494bfe6231e78dd128f097693f2d974761ee4d649e61f5fa2</span>;<span class="comment">//todo</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">repay</span><span class="params">(coin: Coin,loan:Loan)</span></span>&#123;</span><br><span class="line">	assert!(coin.amount &gt;= loan.feedback,ErrNotEnoughFeedback);</span><br><span class="line">	transfer::<span class="built_in">public_transfer</span>(coin,OWNER_ADDR);</span><br><span class="line">	Loan&#123; feedback:_&#125; = loan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">``` &#123;.line-numbers&#125;</span><br><span class="line"></span><br><span class="line">下面是借方模块的代码,使用测试代码演示</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line">#[test_only]</span><br><span class="line"><span class="keyword">module</span> book::test_loan;</span><br><span class="line">use book::loan::Coin;</span><br><span class="line"></span><br><span class="line"><span class="comment">////todo 贷款后赚钱的业务逻辑,这里没有实现</span></span><br><span class="line"><span class="function">fun <span class="title">earn_money</span><span class="params">(coin : Coin )</span> :Coin&#123;</span></span><br><span class="line">    coin</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">#[<span class="built_in">expected_failure</span>(abort_code=book::loan::ErrNotEnoughFeedback)]</span><br><span class="line"><span class="function">fun <span class="title">borrow_test</span><span class="params">()</span></span>&#123;</span><br><span class="line">	let mut ctx = tx_context::<span class="built_in">dummy</span>();</span><br><span class="line">	<span class="built_in">let</span> (coin,loan) = book::loan::<span class="built_in">borrow</span>(<span class="number">233</span>,&amp;mut ctx);</span><br><span class="line">	let new_money = <span class="built_in">earn_money</span>(coin);</span><br><span class="line">	book::loan::<span class="built_in">repay</span>(new_money,loan);</span><br><span class="line">	<span class="comment">//todo 赚钱了，可以把feedback-amount 的钱，存入自己钱包</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="13-5-key-ability"><a href="#13-5-key-ability" class="headerlink" title="13.5 key ability"></a>13.5 key ability</h4><p>目前其他模块存到链上的对象,都需要key+store能力</p>
<p>transfer::public_transfer</p>
<p>transfer::public_freeze_object </p>
<p>transfer::public_share_object</p>
<p><img src="images/image-20241111213712296.png" alt="image-20241111213712296"></p>
<h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><p>可以作为存在链上对象的一个字段.</p>
<p><img src="images/image-20241111213346673.png" alt="image-20241111213346673"></p>
<h3 id="11-切割coin"><a href="#11-切割coin" class="headerlink" title="11 切割coin"></a>11 切割coin</h3><p>下例 从当前的余额中分割出来 0.05 个sui , 然后传给当前地址</p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> C_ADDR=`sui client  active-address`</span><br><span class="line"></span><br><span class="line">sui client ptb \</span><br><span class="line">--split-coins gas [1000] \</span><br><span class="line">--assign coin \</span><br><span class="line">--transfer-objects [coin] @<span class="variable">$C_ADDR</span> \</span><br><span class="line">--gas-budget 50000000</span><br></pre></td></tr></table></figure>







<h2 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h2><table>
<thead>
<tr>
<th>2024年11月10日 11:49</th>
<th>adadadadadadad</th>
<th>吾妻天依美如画</th>
</tr>
</thead>
<tbody><tr>
<td>2024年11月10日 11:52</td>
<td>完全按照视频中操作，却与视频中得到的结果不一样，可能是版本和系统不一样吧，但自己又不会调试</td>
<td>恸</td>
</tr>
<tr>
<td>2024年11月10日 11:57</td>
<td>小白提问预编译的下载包如何使用</td>
<td>krypton</td>
</tr>
<tr>
<td>2024年11月10日 12:00</td>
<td>见证者对象有什么作用，我在好几个地方看到，只知道怎么用，不知道为什么要这么写</td>
<td>柠栀gardenia</td>
</tr>
<tr>
<td>2024年11月10日 14:02</td>
<td>move 中 Table 是通过 dynamic field 实现的，在浏览器中似乎没有办法查到 table 中所有的数据，table 对应的那个 object id 在sui浏览器中也无法访问。只是浏览器不支持，还是说不能实现在链下查到 table 里所有的数据。</td>
<td>Allen</td>
</tr>
<tr>
<td>2024年11月10日 16:17</td>
<td>钱包地址与 sui 客户端地址的关系</td>
<td>罗基</td>
</tr>
<tr>
<td>2024年11月10日 21:05</td>
<td>git pull pull不下来，报错过早文件结束</td>
<td>啊吧啊吧</td>
</tr>
<tr>
<td>2024年11月11日 12:41</td>
<td>自动publish到了devnet上面，不知道怎么回事，scan上面在devnet上能搜到id，但是source code显示不出</td>
<td>洗头就是爽</td>
</tr>
<tr>
<td>2024年11月11日 14:15</td>
<td>move的基础语法不熟悉，比如::是什么意思，drop、key这些都是什么含义等等，感觉可以边helloworld边讲解一下语法，每个词对应的意思，为什么需要这些</td>
<td>周雨阳</td>
</tr>
</tbody></table>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录:"></a>附录:</h1><p>最近在参加HOH 共学活动,</p>
<p>💧 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/d0brr-ao6cZ5t8Z5OO1Mog">HOH水分子公众号</a></p>
<p>🌊 <a target="_blank" rel="noopener" href="https://x.com/0xHOH">HOH水分子X账号</a></p>
<p>📹 <a target="_blank" rel="noopener" href="https://space.bilibili.com/3493269495352098">课程B站账号</a></p>
<p>💻 Github仓库 <a target="_blank" rel="noopener" href="https://github.com/move-cn/letsmove">https://github.com/move-cn/letsmove</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/11/sui/sui-colearn-qa1/" data-id="cm3n9q6w500004eo37lb4ceaf" data-title="2024 -11-11  第一周Sui Move训练营课程答疑问题" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/move/" rel="tag">move</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/sui/" rel="tag">sui</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sui/sui-cap-transfer" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/11/sui/sui-cap-transfer/" class="article-date">
  <time class="dt-published" datetime="2024-11-11T13:47:08.000Z" itemprop="datePublished">2024-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/sui/">sui</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/11/sui/sui-cap-transfer/">2024 -11-20  sui 存钱罐的权限控制和pacakge升级带来的风险</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><ul>
<li>假设写一个存钱罐合约，可以从合约中存入货币，提取货币，<ul>
<li>存钱不控制权限，每个人都能存</li>
<li>只有拥有AdminCap对象的人才能取钱。<ul>
<li>取钱函数有一个AdminCap参数，sui 判断谁拥有Admincap 对象才能调用 withdraw</li>
</ul>
</li>
<li>合约构造者A可以将AdminCap对象 转让给B<ul>
<li>表面上只有B 能获得权限取钱</li>
</ul>
</li>
</ul>
</li>
<li>风险<ul>
<li>合约构造者还拥有升级合约的权限，可能通过升级合约来获取新的取钱权限</li>
</ul>
</li>
</ul>
<h2 id="2-合约代码"><a href="#2-合约代码" class="headerlink" title="2. 合约代码"></a>2. 合约代码</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">module upgrade_demo::upgrade_demo ;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line">    <span class="keyword">use</span> sui::balance::&#123;<span class="keyword">Self</span>, Balance&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::coin::&#123;<span class="keyword">Self</span>, Coin&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::sui::SUI;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;<span class="keyword">Self</span>, TxContext&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误码</span></span><br><span class="line">    <span class="keyword">const</span> ENotAdmin: <span class="type">u64</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> EInsufficientBalance: <span class="type">u64</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 管理员权限凭证</span></span><br><span class="line">    public <span class="keyword">struct</span> <span class="title class_">AdminCap</span> has key, store &#123;</span><br><span class="line">        id: UID</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 金库结构</span></span><br><span class="line">    public <span class="keyword">struct</span> <span class="title class_">Treasury</span> has key &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        balance: Balance&lt;SUI&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化函数 - 创建管理员凭证和金库</span></span><br><span class="line">    fun <span class="title function_ invoke__">init</span>(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">admin_cap</span> = AdminCap &#123;</span><br><span class="line">            id: object::<span class="title function_ invoke__">new</span>(ctx)</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">treasury</span> = Treasury &#123;</span><br><span class="line">            id: object::<span class="title function_ invoke__">new</span>(ctx),</span><br><span class="line">            balance: balance::<span class="title function_ invoke__">zero</span>(),</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将AdminCap转移给部署合约的地址</span></span><br><span class="line">        transfer::<span class="title function_ invoke__">transfer</span>(admin_cap, tx_context::<span class="title function_ invoke__">sender</span>(ctx));</span><br><span class="line">        <span class="comment">// 共享金库对象</span></span><br><span class="line">        transfer::<span class="title function_ invoke__">share_object</span>(treasury);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存入SUI代币</span></span><br><span class="line">    public fun <span class="title function_ invoke__">deposit</span>(treasury: &amp;<span class="keyword">mut</span> Treasury, payment: Coin&lt;SUI&gt;) &#123;</span><br><span class="line">        sui::balance::<span class="title function_ invoke__">join</span>(&amp;<span class="keyword">mut</span> treasury.balance, payment.<span class="title function_ invoke__">into_balance</span>());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 管理员提取SUI代币</span></span><br><span class="line">    public fun <span class="title function_ invoke__">withdraw</span>(</span><br><span class="line">        treasury: &amp;<span class="keyword">mut</span> Treasury, </span><br><span class="line">        amount: <span class="type">u64</span>,</span><br><span class="line">        _admin_cap: &amp;AdminCap,</span><br><span class="line">        ctx: &amp;<span class="keyword">mut</span> TxContext</span><br><span class="line">    ): Coin&lt;SUI&gt; &#123;</span><br><span class="line">        <span class="comment">// 检查余额是否充足</span></span><br><span class="line">        <span class="built_in">assert!</span>(balance::<span class="title function_ invoke__">value</span>(&amp;treasury.balance) &gt;= amount, EInsufficientBalance);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从金库中提取代币</span></span><br><span class="line">        coin::<span class="title function_ invoke__">from_balance</span>(balance::<span class="title function_ invoke__">split</span>(&amp;<span class="keyword">mut</span> treasury.balance, amount), ctx)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询金库余额</span></span><br><span class="line">    public fun <span class="title function_ invoke__">balanceOf</span>(treasury: &amp;Treasury): <span class="type">u64</span> &#123;</span><br><span class="line">        balance::<span class="title function_ invoke__">value</span>(&amp;treasury.balance)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-发布合约"><a href="#3-发布合约" class="headerlink" title="3. 发布合约"></a>3. 发布合约</h2><ul>
<li>获得对象</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui move   --skip-fetch-latest-git-deps  publish</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">╭────────────────────────────────────────────────────────────────────────────────────────────────────────────╮</span><br><span class="line">│ Object Changes                                                                                             │</span><br><span class="line">├────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ Created Objects:                                                                                           │</span><br><span class="line">│  ┌──                                                                                                       │</span><br><span class="line">│  │ ObjectID: 0x10ca605ce0437c10274bcc260901ef5b34bab91c747f2dc498b722ae151a5baf                            │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                              │</span><br><span class="line">│  │ Owner: Account Address ( 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c )           │</span><br><span class="line">│  │ ObjectType: 0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89::upgrade_demo::AdminCap  │</span><br><span class="line">│  │ Version: 245323791                                                                                      │</span><br><span class="line">│  │ Digest: BLp2DjwNMD1fZ4Y4HxNMRz1AQq28afgMQ57pNFt4BZoa                                                    │</span><br><span class="line">│  └──  </span><br><span class="line"></span><br><span class="line">│  ┌──                                                                                                       │</span><br><span class="line">│  │ ObjectID: 0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915bb0                            │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                              │</span><br><span class="line">│  │ Owner: Account Address ( 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c )           │</span><br><span class="line">│  │ ObjectType: 0x2::package::UpgradeCap                                                                    │</span><br><span class="line">│  │ Version: 245323791                                                                                      │</span><br><span class="line">│  │ Di</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ┌──                                                                                                       │</span><br><span class="line">│  │ ObjectID: 0x830243c107ff3ad19e4506d9a61d04af4a0c35771445e468c3a7befbc6d9293c                            │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                              │</span><br><span class="line">│  │ Owner: Shared( 245323791 )                                                                              │</span><br><span class="line">│  │ ObjectType: 0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89::upgrade_demo::Treasury  │</span><br><span class="line">│  │ Version: 245323791                                                                                      │</span><br><span class="line">│  │ Digest: Enq9zenKrY4r3fXYEWr9XJCcA8FixSTZhKbVqXqDueNM </span><br></pre></td></tr></table></figure>
<ul>
<li>对象说明</li>
</ul>
<table>
<thead>
<tr>
<th>对象名</th>
<th>取值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>package address</td>
<td>0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89</td>
<td>合约包的地址</td>
</tr>
<tr>
<td>upgradeCap</td>
<td>0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915bb0</td>
<td>控制升级的权限</td>
</tr>
<tr>
<td>adminCap</td>
<td>0x10ca605ce0437c10274bcc260901ef5b34bab91c747f2dc498b722ae151a5baf</td>
<td>控制提取Treasury余额</td>
</tr>
<tr>
<td>owner</td>
<td>0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c</td>
<td>目前合约发布者拥有adminCap,upgradeCap</td>
</tr>
<tr>
<td>treasury</td>
<td>0x830243c107ff3ad19e4506d9a61d04af4a0c35771445e468c3a7befbc6d9293c</td>
<td>存钱罐</td>
</tr>
</tbody></table>
<ul>
<li><p>查看当前用户的coin</p>
<figure class="highlight bash"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sui client gas</span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x09119914c43f80a486b30cc5d4f1382d0b57929eabd70f116ae4e918d9c89bf0 │ 470927364          │ 0.47             │</span><br><span class="line">│ 0xae3da3cb598610db16ea040ad6b09cfd324e146a2a7e5b18ccfa76b34b8d3b22 │ 497664604          │ 0.49             │</span><br><span class="line">│ 0xeda78a0ba9b2ef153a209f51380d8e77af0f35c60eb8ea26d4239c639844680d │ 995399888          │ 0.99             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-A用户存钱"><a href="#4-A用户存钱" class="headerlink" title="4. A用户存钱"></a>4. A用户存钱</h2><ul>
<li>配置一些变量，方便后面的脚本使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PKG=0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89</span><br><span class="line"><span class="built_in">export</span> ADMIN_CAP=0x10ca605ce0437c10274bcc260901ef5b34bab91c747f2dc498b722ae151a5baf</span><br><span class="line"><span class="built_in">export</span> UPGRADE_CAP=0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915bb0</span><br><span class="line"><span class="built_in">export</span> TREASURY=0x830243c107ff3ad19e4506d9a61d04af4a0c35771445e468c3a7befbc6d9293c     </span><br><span class="line"><span class="built_in">export</span> ADDR_A=0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c</span><br><span class="line"><span class="built_in">export</span> ADDR_B=0x7cbe5e6596e23266dd5763dd89b4ab1195516908ecde8febfe96685c7cbe6432</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前用户有哪些coin</span></span><br><span class="line">sui client switch --address <span class="variable">$ADDR_A</span></span><br><span class="line">sui client gas</span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x09119914c43f80a486b30cc5d4f1382d0b57929eabd70f116ae4e918d9c89bf0 │ 470927364          │ 0.47             │</span><br><span class="line">│ 0xae3da3cb598610db16ea040ad6b09cfd324e146a2a7e5b18ccfa76b34b8d3b22 │ 497664604          │ 0.49             │</span><br><span class="line">│ 0xeda78a0ba9b2ef153a209f51380d8e77af0f35c60eb8ea26d4239c639844680d │ 995399888          │ 0.99             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据前面的输出，设置需要存入的coin</span></span><br><span class="line"><span class="built_in">export</span> COIN_A=0xae3da3cb598610db16ea040ad6b09cfd324e146a2a7e5b18ccfa76b34b8d3b22</span><br><span class="line"><span class="comment"># 存入货币</span></span><br><span class="line">sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::deposit   <span class="string">&quot;@<span class="variable">$TREASURY</span>,@<span class="variable">$COIN_A</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-A-用户取钱"><a href="#5-A-用户取钱" class="headerlink" title="5. A 用户取钱"></a>5. A 用户取钱</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::deposit   <span class="string">&quot;@<span class="variable">$TREASURY</span> @0xae3da3cb598610db16ea040ad6b09cfd324e146a2a7e5b18ccfa76b34b8d3b22&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>取回5000单位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::withdraw <span class="string">&quot;@<span class="variable">$TREASURY</span> 50000 @<span class="variable">$ADMIN_CAP</span>&quot;</span></span><br><span class="line">sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::withdraw <span class="string">&quot;@<span class="variable">$TREASURY</span> 50000 @<span class="variable">$ADMIN_CAP</span>&quot;</span> --assign coin1 --transfer-objects [coin1] @<span class="variable">$ADDR_A</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前A用户拥有的coin</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sui client gas $ADDR_A</span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x09119914c43f80a486b30cc5d4f1382d0b57929eabd70f116ae4e918d9c89bf0 │ 466808880          │ 0.46             │</span><br><span class="line">│ 0xd91123cfc325ba1eff95e839837a1bf443046cc00a72da5192a005ffea1a7117 │ 50000              │ 0.00             │</span><br><span class="line">│ 0xeda78a0ba9b2ef153a209f51380d8e77af0f35c60eb8ea26d4239c639844680d │ 995399888          │ 0.99             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br></pre></td></tr></table></figure>


<h2 id="6-A-用户转移adminCap-给B"><a href="#6-A-用户转移adminCap-给B" class="headerlink" title="6. A 用户转移adminCap 给B"></a>6. A 用户转移adminCap 给B</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sui client ptb --transfer-objects [@<span class="variable">$ADMIN_CAP</span>] @<span class="variable">$ADDR_B</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示ADMIN_CAP 对象的owner是0x7cbe5e6596e23266dd5763dd89b4ab1195516908ecde8febfe96685c7cbe6432</span></span><br><span class="line"></span><br><span class="line">│  ┌──                                                                                                       │</span><br><span class="line">│  │ ObjectID: 0x10ca605ce0437c10274bcc260901ef5b34bab91c747f2dc498b722ae151a5baf                            │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                              │</span><br><span class="line">│  │ Owner: Account Address ( 0x7cbe5e6596e23266dd5763dd89b4ab1195516908ecde8febfe96685c7cbe6432 )           │</span><br><span class="line">│  │ ObjectType: 0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89::upgrade_demo::AdminCap  │</span><br><span class="line">│  │ Version: 245323796                                                                                      │</span><br><span class="line">│  │ Digest: 6QpfZqgrTFjTcaySHPrfS5cDE1K1L5xvuWDQRxh1vumS                                                    │</span><br><span class="line">│  └── </span><br></pre></td></tr></table></figure>

<h2 id="7-A用户-再次取款，预期会失败"><a href="#7-A用户-再次取款，预期会失败" class="headerlink" title="7. A用户 再次取款，预期会失败"></a>7. A用户 再次取款，预期会失败</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::withdraw <span class="string">&quot;@<span class="variable">$TREASURY</span> 50000 @<span class="variable">$ADMIN_CAP</span>&quot;</span> --assign coin1 --transfer-objects [coin1] @<span class="variable">$ADDR_A</span> --gas-budget 30000000</span><br><span class="line">RPC call failed: ErrorObject &#123; code: ServerError(-32002), message: <span class="string">&quot;Transaction validator signing failed due to issues with transaction inputs, please review the errors and try again:\n- Transaction was not signed by the correct sender: Object 0x10ca605ce0437c10274bcc260901ef5b34bab91c747f2dc498b722ae151a5baf is owned by account address 0x7cbe5e6596e23266dd5763dd89b4ab1195516908ecde8febfe96685c7cbe6432, but given owner/signer address is 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c\n- Could not find the referenced object 0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89 at version None&quot;</span>, data: None &#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-切换B-用户，取款成功"><a href="#8-切换B-用户，取款成功" class="headerlink" title="8. 切换B 用户，取款成功"></a>8. 切换B 用户，取款成功</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到ADDR_B</span></span><br><span class="line">$ sui client switch --address <span class="variable">$ADDR_B</span></span><br><span class="line">Active address switched to 0x7cbe5e6596e23266dd5763dd89b4ab1195516908ecde8febfe96685c7cbe6432</span><br><span class="line"><span class="comment"># 调用withdraw取款</span></span><br><span class="line">$ sui client ptb --move-call <span class="variable">$PKG</span>::upgrade_demo::withdraw <span class="string">&quot;@<span class="variable">$TREASURY</span> 50000 @<span class="variable">$ADMIN_CAP</span>&quot;</span> --assign coin1 --transfer-objects [coin1] @<span class="variable">$ADDR_B</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看获得50000 mist的coin</span></span><br><span class="line">$ sui client gas</span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x015a3cb7a04cdcd7631e4056f56e8a55b77a1a7d05dc7da6f30e9ac705d19b7c │ 50000              │ 0.00             │</span><br><span class="line">│ 0x418760c10d6fe9ecaa2594803848412c834f58983f1be03b26962a22dd84f9e5 │ 995949216          │ 0.99             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br></pre></td></tr></table></figure>

<h2 id="9-A-用户发起攻击，升级合约包，-新建AdminCap对象adminCap2"><a href="#9-A-用户发起攻击，升级合约包，-新建AdminCap对象adminCap2" class="headerlink" title="9. A 用户发起攻击，升级合约包， 新建AdminCap对象adminCap2"></a>9. A 用户发起攻击，升级合约包， 新建AdminCap对象adminCap2</h2><h3 id="9-1-修改合约代码，新构造AdminCap对象"><a href="#9-1-修改合约代码，新构造AdminCap对象" class="headerlink" title="9.1 修改合约代码，新构造AdminCap对象"></a>9.1 修改合约代码，新构造AdminCap对象</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">mintCap</span><span class="params">(ctx: &amp;mut TxContext)</span>: AdminCap &#123;</span></span><br><span class="line">    AdminCap&#123;id: object::<span class="keyword">new</span>(ctx)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-2-升级合约"><a href="#9-2-升级合约" class="headerlink" title="9.2 升级合约"></a>9.2 升级合约</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换为A</span></span><br><span class="line">sui client switch --address <span class="variable">$ADDR_A</span></span><br><span class="line">Active address switched to 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c</span><br><span class="line"><span class="comment"># A 升级合约</span></span><br><span class="line">sui client upgrade  --upgrade-capability <span class="variable">$UPGRADE_CAP</span>  --gas-budget 100000000  --skip-fetch-latest-git-deps</span><br><span class="line"><span class="comment"># 升级对象变更，package版本增长 ,版本id 变成了 0xc163e33f376cae7a90b0c56b49af9a0aa387c210792d6c76aba0a12a22de8869</span></span><br><span class="line">老的版本<span class="built_in">id</span>是0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89</span><br><span class="line">│  ┌──                                                                                             │</span><br><span class="line">│  │ ObjectID: 0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915bb0                  │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                    │</span><br><span class="line">│  │ Owner: Account Address ( 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c ) │</span><br><span class="line">│  │ ObjectType: 0x2::package::UpgradeCap                                                          │</span><br><span class="line">│  │ Version: 245323797                                                                            │</span><br><span class="line">│  │ Digest: 64rX9ChLmX5mupim2UqRGUoKnHD3wTiiYg4uXxzjvppc                                          │</span><br><span class="line">│  └──                                                                                             │</span><br><span class="line">│ Published Objects:                                                                               │</span><br><span class="line">│  ┌──                                                                                             │</span><br><span class="line">│  │ PackageID: 0xc163e33f376cae7a90b0c56b49af9a0aa387c210792d6c76aba0a12a22de8869                 │</span><br><span class="line">│  │ Version: 2                                                                                    │</span><br><span class="line">│  │ Digest: 8aWACYMu9nLjAG3MHQGteXMsNiBUY5xCt6KhKmMEmrTX                                          │</span><br><span class="line">│  │ Modules: upgrade_demo                                                                         │</span><br><span class="line">│  └──                   </span><br></pre></td></tr></table></figure>

<ul>
<li><p>新发布的的包 id发生改变</p>
<p>0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915bb0</p>
</li>
</ul>
<h2 id="9-3-发起攻击"><a href="#9-3-发起攻击" class="headerlink" title="9.3  发起攻击"></a>9.3  发起攻击</h2><p>用户用新创建的adminCap2 来取钱</p>
<p>初始的package</p>
<p><img src="images/image-20241120130414556.png" alt="image-20241120130414556"></p>
<ul>
<li>1 pacakge object id</li>
<li>2 版本</li>
<li>3 代码中的包地址。</li>
</ul>
<p>升级后的packageid发生变更</p>
<p><img src="images/image-20241120125933911.png" alt="image-20241120125933911"></p>
<ul>
<li>1 package object id</li>
<li>2 版本</li>
<li>3 代码中的package地址</li>
</ul>
<p>但是从代码看，package地址 还是最初发布的地址，version&#x3D;2， 代码module后面的地址不变。 但是objectid发生变更（图1）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$  <span class="built_in">export</span> PKG2=0xc163e33f376cae7a90b0c56b49af9a0aa387c210792d6c76aba0a12a22de8869</span><br><span class="line">$  sui client ptb --move-call <span class="variable">$PKG2</span>::upgrade_demo::mintCap --assign new_cap --transfer-objects [<span class="string">&quot;new_cap&quot;</span> ] @<span class="variable">$ADDR_A</span></span><br><span class="line"></span><br><span class="line"> Created Objects:                                                                                           │</span><br><span class="line">│  ┌──                                                                                                       │</span><br><span class="line">│  │ ObjectID: 0xb71d4b11e35d769bcdefa42f9706af118b76b2ab2896fe2a294639e19f52d816                            │</span><br><span class="line">│  │ Sender: 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c                              │</span><br><span class="line">│  │ Owner: Account Address ( 0x6560a053cd8d98925b33ab2b951d656736d0133734def0b5d679402fc555576c )           │</span><br><span class="line">│  │ ObjectType: 0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89::upgrade_demo::AdminCap  │</span><br><span class="line">│  │ Version: 245323798                                                                                      │</span><br><span class="line">│  │ Digest: 8xio19V93oLgmF8jLxWKoCfgCpSitFJqYLLLTbN9Wc77                                                    │</span><br><span class="line">│  └──  </span><br><span class="line">$ <span class="built_in">export</span>  ADMIN_CAP2=0xb71d4b11e35d769bcdefa42f9706af118b76b2ab2896fe2a294639e19f52d816</span><br><span class="line">$ sui client ptb --move-call <span class="variable">$PKG2</span>::upgrade_demo::withdraw <span class="string">&quot;@<span class="variable">$TREASURY</span> 6000 @<span class="variable">$ADMIN_CAP2</span>&quot;</span> \</span><br><span class="line">--assign coin2 --transfer-objects [coin2] @<span class="variable">$ADDR_A</span></span><br><span class="line"><span class="comment"># 偷取成功，获得一个6000mist的coin</span></span><br><span class="line">$ sui client gas <span class="variable">$ADDR_A</span></span><br><span class="line">╭────────────────────────────────────────────────────────────────────┬────────────────────┬──────────────────╮</span><br><span class="line">│ gasCoinId                                                          │ mistBalance (MIST) │ suiBalance (SUI) │</span><br><span class="line">├────────────────────────────────────────────────────────────────────┼────────────────────┼──────────────────┤</span><br><span class="line">│ 0x09119914c43f80a486b30cc5d4f1382d0b57929eabd70f116ae4e918d9c89bf0 │ 450920664          │ 0.45             │</span><br><span class="line">│ 0x33233ad9e71a8ef079b7c1c58ac9c99a263d04620f585d37e1ae94b4bd64d538 │ 6000               │ 0.00             │</span><br><span class="line">│ 0x64502383e84a24dda2e531ec0cac4d8123c9c4d7820451a1b42a02eae1888bea │ 50000              │ 0.00             │</span><br><span class="line">│ 0xd91123cfc325ba1eff95e839837a1bf443046cc00a72da5192a005ffea1a7117 │ 50000              │ 0.00             │</span><br><span class="line">│ 0xeda78a0ba9b2ef153a209f51380d8e77af0f35c60eb8ea26d4239c639844680d │ 995399888          │ 0.99             │</span><br><span class="line">╰────────────────────────────────────────────────────────────────────┴────────────────────┴──────────────────╯</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PKG=0x38417a57a4f061487895b2c97b3e188e847c25de37762c5e0146bd6a32cd5a89</span><br><span class="line"><span class="built_in">export</span> UPGRADE_CAP=0x67a5815e053ab8be8248c894ec288baf79bc6f323321812074cac70e63915嗯嗯</span><br><span class="line"></span><br><span class="line">$ sui client upgrade  --upgrade-capability <span class="variable">$UPGRADE_CAP</span> --package-id <span class="variable">$PKG</span> --gas-budget 100000000</span><br></pre></td></tr></table></figure>

<h2 id="对策："><a href="#对策：" class="headerlink" title="对策："></a>对策：</h2><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><ul>
<li>转移权限时，将UpgradeCap也转移</li>
</ul>
<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><ul>
<li><p>在 Treasury 中添加adminCap的id。</p>
</li>
<li><p>在取款的时候做校验</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="comment">// 金库结构</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Treasury</span> has key &#123;</span><br><span class="line">     id: UID,</span><br><span class="line">     balance: Balance&lt;SUI&gt;,</span><br><span class="line"> +   admin_id : ID,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 初始化函数 - 创建管理员凭证和金库</span></span><br><span class="line"> <span class="function">fun <span class="title">init</span><span class="params">(ctx: &amp;mut TxContext)</span> </span>&#123;</span><br><span class="line">     let admin_cap = AdminCap &#123;</span><br><span class="line">         id: object::<span class="built_in">new</span>(ctx)</span><br><span class="line">     &#125;;</span><br><span class="line">     </span><br><span class="line">     let treasury = Treasury &#123;</span><br><span class="line">         id: object::<span class="built_in">new</span>(ctx),</span><br><span class="line">         balance: balance::<span class="built_in">zero</span>(),</span><br><span class="line">+        admin_id: *admin_cap.id.<span class="built_in">as_inner</span>(),</span><br><span class="line">     &#125;</span><br><span class="line">     ...</span><br><span class="line">         </span><br><span class="line">         </span><br><span class="line">              <span class="comment">// 管理员提取SUI代币</span></span><br><span class="line"> <span class="keyword">public</span> fun <span class="built_in">withdraw</span>(</span><br><span class="line">     treasury: &amp;mut Treasury, </span><br><span class="line">     amount: u64,</span><br><span class="line">     admin_cap: &amp;AdminCap,</span><br><span class="line">     ctx: &amp;mut TxContext</span><br><span class="line"> ): Coin&lt;SUI&gt; &#123;</span><br><span class="line">+     assert!(admin_cap.id.<span class="built_in">as_inner</span>() == treasury.admin_id, ENotAdmin);</span><br><span class="line">   ...</span><br><span class="line">       </span><br></pre></td></tr></table></figure>



<h1 id="附录"><a href="#附录" class="headerlink" title="附录:"></a>附录:</h1><p>最近在参加HOH 共学活动,</p>
<p>💧 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/d0brr-ao6cZ5t8Z5OO1Mog">HOH水分子公众号</a></p>
<p>🌊 <a target="_blank" rel="noopener" href="https://x.com/0xHOH">HOH水分子X账号</a></p>
<p>📹 <a target="_blank" rel="noopener" href="https://space.bilibili.com/3493269495352098">课程B站账号</a></p>
<p>💻 Github仓库 <a target="_blank" rel="noopener" href="https://github.com/move-cn/letsmove">https://github.com/move-cn/letsmove</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/11/sui/sui-cap-transfer/" data-id="cm3pg1bfv0002zno33wp74z5s" data-title="2024 -11-20  sui 存钱罐的权限控制和pacakge升级带来的风险" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/move/" rel="tag">move</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/package-upgrade/" rel="tag">package upgrade</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/sui/" rel="tag">sui</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sui/sui-coin-concepts" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/10/sui/sui-coin-concepts/" class="article-date">
  <time class="dt-published" datetime="2024-11-10T02:08:11.000Z" itemprop="datePublished">2024-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/sui/">sui</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/10/sui/sui-coin-concepts/">sui coin 的一些概念 设计思想和练习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-货币具有如下特征，-sui-coin-实现对应的特征"><a href="#1-货币具有如下特征，-sui-coin-实现对应的特征" class="headerlink" title="1. 货币具有如下特征， sui coin 实现对应的特征"></a>1. 货币具有如下特征， sui coin 实现对应的特征</h1><h2 id="1-1-货币的特征"><a href="#1-1-货币的特征" class="headerlink" title="1.1 货币的特征"></a>1.1 货币的特征</h2><ul>
<li><p>发币权限</p>
<ul>
<li>控制发布权限<ul>
<li>一般来说,我们需要控制货币的发行量, 一般限制特定的人或组织才能发型货币.<ul>
<li>若货币无限制发型, 货币就没有价值</li>
</ul>
</li>
</ul>
</li>
<li>sui 使用TreasuryCap 对象的所有权来控制货币的发行权</li>
<li>共享发币权限—faucet<ul>
<li>这种情况只用作测试 本文不做讨论。</li>
</ul>
</li>
</ul>
</li>
<li><p>货币的总供应量</p>
<ul>
<li>sui 采用 Supply<ul>
<li>能增加发行量， 提供新的余额Balance  ， increase_supply</li>
<li>能回收货币余额，减少货币供应  decrease_supply</li>
</ul>
</li>
</ul>
</li>
<li><p>coin货币的余额(balance) , 也就是:面值几块钱</p>
<ul>
<li>数字货币,余额可以变动</li>
<li>可以3块的货币,拆成 2.5元  和0.5元 两个coin</li>
</ul>
</li>
<li><p>coin 货币有特征, 人民币之所以是人民币,不是美元,是因为人民币有独特的图形 </p>
<ul>
<li>对应  CoinMetadata</li>
</ul>
</li>
</ul>
<h2 id="1-2-Sui-Coin相关对象类型关系图"><a href="#1-2-Sui-Coin相关对象类型关系图" class="headerlink" title="1.2 Sui Coin相关对象类型关系图"></a>1.2 Sui Coin相关对象类型关系图</h2><p>  <img src="images/image-20241116221238292-1731949327268-7.png" alt="image-20241116221238292"></p>
<pre><code>- create_currency 是货币创建的函数, 返回一个TreasuryCap 对象和一个CoinMetadata对象
- CoinMetadata 表示货币的小数位,名称,图标.
- TreasuryCap 持有一个Supply对象,这个Supply是实现货币增长和减少的关键对象.
- Supply 能提供货币余额 Balance, 同时增加总货币供应量.
- Coin 表示可以保存在链上的货币
- Balance 可以转换成Coin 存储到链上,转移给某个用户
- Coin也可以转换成Balance  余额,Balance没有key能力, 但是具有store能力,可以作为其他对象的字段.
- Coin 和Balance 可以通过join(两个币合成一个),split( 一个币分成2个)
</code></pre>
<h2 id="1-3-CoinMetadata"><a href="#1-3-CoinMetadata" class="headerlink" title="1.3 CoinMetadata ,"></a>1.3 CoinMetadata ,</h2><p>可以认为是一种货币的展现形式, 例如没有,就是这个样子的.</p>
<p>通过这个数据结构,告诉我的货币是美元,就能展现成美元的形式.</p>
<p><img src="images/v2-6c896a325f97d97fad2ce3a82a70b183_720w-1731949327268-6.jpg" alt="电影《无双》中为什么画家需要手绘美元母版？ - 知乎"></p>
<p>或者日元:</p>
<p><img src="images/OIP-C-1731949327268-5.jpeg" alt="img"></p>
<h2 id="1-4-我们定义的货币Coin-和CoinMetadata-是怎么关联上的呢"><a href="#1-4-我们定义的货币Coin-和CoinMetadata-是怎么关联上的呢" class="headerlink" title="1.4 我们定义的货币Coin , 和CoinMetadata 是怎么关联上的呢**?"></a>1.4 我们定义的货币Coin , 和CoinMetadata 是怎么关联上的呢**?</h2><ul>
<li>是根据他们的<strong>泛型参数T</strong>  关联的</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A coin of type `T` worth `value`. Transferable and storable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Coin</span>&lt;phantom T&gt; has key, store &#123;</span><br><span class="line">    id: UID,</span><br><span class="line">    balance: Balance&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Each Coin type T created through `create_currency` function will have a</span></span><br><span class="line"><span class="comment">/// unique instance of CoinMetadata&lt;T&gt; that stores the metadata for this coin type.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">CoinMetadata</span>&lt;phantom T&gt; has key, store &#123;</span><br><span class="line">    id: UID,</span><br><span class="line">    <span class="comment">/// Number of decimal places the coin uses.</span></span><br><span class="line">    <span class="comment">/// A coin with `value ` N and `decimals` D should be shown as N / 10^D</span></span><br><span class="line">    <span class="comment">/// E.g., a coin with `value` 7002 and decimals 3 should be displayed as 7.002</span></span><br><span class="line">    <span class="comment">/// This is metadata for display usage only.</span></span><br><span class="line">    decimals: u8,</span><br><span class="line">    <span class="comment">/// Name for the token</span></span><br><span class="line">    name: string::String,</span><br><span class="line">    <span class="comment">/// Symbol for the token</span></span><br><span class="line">    symbol: ascii::String,</span><br><span class="line">    <span class="comment">/// Description of the token</span></span><br><span class="line">    description: string::String,</span><br><span class="line">    <span class="comment">/// URL for the token logo</span></span><br><span class="line">    icon_url: Option&lt;Url&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="2-货币的诞生："><a href="#2-货币的诞生：" class="headerlink" title="2. 货币的诞生："></a>2. 货币的诞生：</h1><h2 id="2-1-货币诞生相关函数的启发"><a href="#2-1-货币诞生相关函数的启发" class="headerlink" title="2.1 货币诞生相关函数的启发"></a>2.1 货币诞生相关函数的启发</h2><p>参看 0x2:sui::coin 的创建货币的代码,需要一个otw对象.<br><img src="images/image-20241111221059544-1731949327268-8.png" alt="image-20241111221059544"></p>
<p>货币诞生需要这个泛型参数witness丢想是一个One Time Witness struct 对象</p>
<ul>
<li><p>这个结构体只能在模块同名大写, 并且由系统控制只构造一次</p>
<p>例如  0x2::sui::SUI<br>0X433 :: rmb::RMB</p>
</li>
<li><p>不能通过编码构造这个对象</p>
</li>
<li><p>避免通过升级package,增加一个函数 来构造otw 对象</p>
</li>
</ul>
<p>这个例子中 witness 对象 只会在是一个OTW 对象,这个对象在模块初始化的时候构建,传入这个函数之后,在这个函数结束后销毁,因为它是移动所有权传递(没有copy ability), 同时具有drop ability.</p>
<p>这个方法执行的结果,会让这个货币相关查到Coin,CoinMetadata ,TreasuryCap  ,Supply,Balance 这一系列对象,都有个类型参数<code>type-arg</code>是<code>witness</code>参数的类型.</p>
<h2 id="2-2-示例-发行一种日元"><a href="#2-2-示例-发行一种日元" class="headerlink" title="2.2  示例:发行一种日元"></a>2.2  示例:发行一种日元</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span> <span class="attr">coin_jp</span>::jp&#123;</span><br><span class="line">    <span class="keyword">public</span> struct <span class="variable constant_">JP</span> has drop&#123; &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">JpUrl</span>:vector&lt;u8&gt; = b<span class="string">&quot;https://tse4-mm.cn.bing.net/th/id/OIP-C.XVkbV--98d7_YfeLR2a_fAHaHa&quot;</span>;</span><br><span class="line"></span><br><span class="line">    fun <span class="title function_">init</span>(<span class="params"> jp :JP , ctx : &amp;mut <span class="title class_">TxContext</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_">let</span> (treasuryCap,coinMetadata) = <span class="attr">sui</span>::<span class="attr">coin</span>::<span class="title function_">create_currency</span>(</span><br><span class="line">                jp, </span><br><span class="line">                <span class="number">0</span>, </span><br><span class="line">                b<span class="string">&quot;YEN&quot;</span>,</span><br><span class="line">                b<span class="string">&quot;YEN of Japan&quot;</span>, </span><br><span class="line">                b<span class="string">&quot;Japanese money&quot;</span>,</span><br><span class="line">                <span class="attr">option</span>::<span class="title function_">some</span>(<span class="attr">sui</span>::<span class="attr">url</span>::<span class="title function_">new_unsafe_from_bytes</span>(<span class="title class_">JpUrl</span>)),</span><br><span class="line">                ctx);</span><br><span class="line"></span><br><span class="line">        <span class="attr">transfer</span>::<span class="title function_">public_transfer</span>(treasuryCap,ctx.<span class="title function_">sender</span>());</span><br><span class="line">        <span class="attr">transfer</span>::<span class="title function_">public_freeze_object</span>(coinMetadata);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意模块名jp和 struct JP 的对应关系,OTW 结构体是模块名的大写. 这个结构体JP ,就是一个OTW 结构体, </li>
<li>init函数传入的jp对象,是package在部署的时候自动构造出来的对象.</li>
<li>以后无法通过升级package来重新构建一个JP 类型的对象.这就保证了铸币能力 TreasuryCap.total_supply的唯一性.</li>
</ul>
<p>这个定义,等于设置了一个日元的外观定义(CoinMetadata), 日元的增发权限 TreasuryCap ,   以后发行的日元,余额, 都有特性花纹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">coin_jp::jp::JP</span><br></pre></td></tr></table></figure>

<p>这个coin_jp是地址,当move package应该在发布的时候,确定其地址取值.</p>
<h2 id="2-3-新建货币流程"><a href="#2-3-新建货币流程" class="headerlink" title="2.3  新建货币流程"></a>2.3  新建货币流程</h2><p><img src="images/image-20241116225504184-1731949327268-9.png" alt="image-20241116225504184"></p>
<p>发布这个合约就是诞生了一种货币,我们其实只是定义了一种铸币权(包括货币增加 减少的能力), 和货币的样式 CoinMetadata, (方便在suiscan上浏览它)</p>
<h1 id="3-货币的增发"><a href="#3-货币的增发" class="headerlink" title="3.货币的增发"></a>3.货币的增发</h1><p>增加货币（mint）流程</p>
<p><img src="images/image-20241116231338675-1731949327269-11.png" alt="image-20241116231338675"></p>
<pre><code>1. 客户端发起mint_and_transfer 的rpc调用 。 客户端需要拥有访问TreasuryCap对象的权利 （增发货币的权力）
1. TreasuryCap 调用mint 方法还增加货币
1. Treasury 调用它的total_supply对象的increase_supply 方法
1. Supply 在balance 模块，能构建同一模块的Balance对象
1. Supply获得Balance对象
1. 返回Balance对象给TreasuryCap对象
1. TreasuryCap对象，用Balance对象来构造 coin模块中的Coin对象
1. 返回Coin对象
1. 通过public_transfer方法，讲Coin存到链上，归属给mint_and_transfer 参数中的地址。#
</code></pre>
<h1 id="4-发布合约，增发货币的调用脚本："><a href="#4-发布合约，增发货币的调用脚本：" class="headerlink" title="4. 发布合约，增发货币的调用脚本："></a>4. 发布合约，增发货币的调用脚本：</h1><h2 id="4-1-发布合约-脚本"><a href="#4-1-发布合约-脚本" class="headerlink" title="4.1 发布合约 脚本"></a>4.1 发布合约 脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sui client publish --skip-fetch-latest-git-deps --skip-dependency-verification</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查看输出结果中的 0x2::coin::TreasuryCap 对象</span><br><span class="line"> │ ObjectID: 0x8e1bebaac6dd33bf486fb294981f13fb6946051f465db0c25401b61b01f7421e                                     │</span><br><span class="line">│  │ Sender: 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38                                       │</span><br><span class="line">│  │ Owner: Account Address ( 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38 )                    │</span><br><span class="line">│  │ ObjectType: 0x2::coin::TreasuryCap&lt;0x65a0995fd59c97b94fd975a3fb42c745cdff54711c1caae2934858e6eb99adb4::jp::JP&gt;   │</span><br><span class="line">│  │ Version: 236167313                                                                                               │</span><br><span class="line">│  │ Digest: BnpekhzZQWQnR77hpGMZyhafRrMe57AyJainuFX8xEjg   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相关对象标识, 为后续增发提供变量.</p>
<table>
<thead>
<tr>
<th>对象名</th>
<th>export name</th>
<th>对象值</th>
</tr>
</thead>
<tbody><tr>
<td>package地址</td>
<td>PKG</td>
<td>0x65a0995fd59c97b94fd975a3fb42c745cdff54711c1caae2934858e6eb99adb4</td>
</tr>
<tr>
<td>0x2::coin::TreasuryCap 对象id</td>
<td>JP_CAP</td>
<td>0x8e1bebaac6dd33bf486fb294981f13fb6946051f465db0c25401b61b01f7421e</td>
</tr>
</tbody></table>
<h2 id="4-2-调用合约-增发货币"><a href="#4-2-调用合约-增发货币" class="headerlink" title="4.2 调用合约 增发货币"></a>4.2 调用合约 增发货币</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 根据前面的package地址和</span></span><br><span class="line"><span class="built_in">export</span>  PKG=0x65a0995fd59c97b94fd975a3fb42c745cdff54711c1caae2934858e6eb99adb4</span><br><span class="line"><span class="built_in">export</span> JP_CAP=0x8e1bebaac6dd33bf486fb294981f13fb6946051f465db0c25401b61b01f7421e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前激活的地址</span></span><br><span class="line"><span class="built_in">export</span> C_ADDR=`sui client active-address`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行铸币,transfer给本地址</span></span><br><span class="line">sui client call --package 0x2 --module coin --<span class="keyword">function</span> mint_and_transfer --type-args <span class="variable">$PKG</span>::jp::JP  --args <span class="variable">$JP_CAP</span>   8800000   <span class="variable">$C_ADDR</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看输出结果,有创建的0x2::coin::Coin 对象.0x95245c704b124aa96f49ab1cdd459c7219d1dc1165faaeae80a514524e8308e2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> Created Objects:                                                                                                   │</span><br><span class="line">│  ┌──                                                                                                               │</span><br><span class="line">│  │ ObjectID: 0x95245c704b124aa96f49ab1cdd459c7219d1dc1165faaeae80a514524e8308e2                                    │</span><br><span class="line">│  │ Sender: 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38                                      │</span><br><span class="line">│  │ Owner: Account Address ( 0x540105a7d2f5f54a812c630f2996f1790ed0e60d1f9a870ce397f03e4cec9b38 )                   │</span><br><span class="line">│  │ ObjectType: 0x2::coin::Coin&lt;0x65a0995fd59c97b94fd975a3fb42c745cdff54711c1caae2934858e6eb99adb4::jp::JP&gt;         │</span><br><span class="line">│  │ Version: 236167314                                                                                              │</span><br><span class="line">│  │ Digest: Gh2shitikPnbxxffpPj5mnWwrUCNJChEPyCNaBB2YHMV     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-3-使用命令查看余额"><a href="#4-3-使用命令查看余额" class="headerlink" title="4.3  使用命令查看余额"></a>4.3  使用命令查看余额</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查看获得货币</span><br><span class="line">sui client balance $C_ADDR</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ljl@ljl-i5-14400:~/work/sui/move-cn/letsmove/mover/nextuser/code$ sui client balance</span><br><span class="line">[warn] Client/Server api version mismatch, client api version : 1.37.1, server api version : 1.37.2</span><br><span class="line">╭──────────────────────────────────────────────╮</span><br><span class="line">│ Balance of coins owned by this address       │</span><br><span class="line">├──────────────────────────────────────────────┤</span><br><span class="line">│ ╭──────────────────────────────────────────╮ │</span><br><span class="line">│ │ coin          balance (raw)  balance     │ │</span><br><span class="line">│ ├──────────────────────────────────────────┤ │</span><br><span class="line">│ │ Sui           3637300968     3.63 SUI    │ │</span><br><span class="line">│ │ YEN of Japan  8800000        8.80M YEN   │ │</span><br><span class="line">│ ╰──────────────────────────────────────────╯ │</span><br></pre></td></tr></table></figure>

<h2 id="4-4-sui-scan上查看coin对象"><a href="#4-4-sui-scan上查看coin对象" class="headerlink" title="4.4  sui scan上查看coin对象"></a>4.4  sui scan上查看coin对象</h2><p><a target="_blank" rel="noopener" href="https://suiscan.xyz/testnet/object/0x95245c704b124aa96f49ab1cdd459c7219d1dc1165faaeae80a514524e8308e2">https://suiscan.xyz/testnet/object/0x95245c704b124aa96f49ab1cdd459c7219d1dc1165faaeae80a514524e8308e2</a></p>
<p><img src="images/image-20241116223844785-1731949327269-10.png" alt="image-20241116223844785"></p>
<p>   1 . 能看到这个泛型的T 参数是模型名jp和结构体名JP的相似性</p>
<ol start="2">
<li>owner是铸币时传递的地址</li>
<li>显示了货币的余额与图标</li>
</ol>
<h1 id="5-附录"><a href="#5-附录" class="headerlink" title="5. 附录:"></a>5. 附录:</h1><p>最近在参加HOH 共学活动,</p>
<p>💧 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/d0brr-ao6cZ5t8Z5OO1Mog">HOH水分子公众号</a></p>
<p>🌊 <a target="_blank" rel="noopener" href="https://x.com/0xHOH">HOH水分子X账号</a></p>
<p>📹 <a target="_blank" rel="noopener" href="https://space.bilibili.com/3493269495352098">课程B站账号</a></p>
<p>💻 Github仓库 <a target="_blank" rel="noopener" href="https://github.com/move-cn/letsmove">https://github.com/move-cn/letsmove</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/10/sui/sui-coin-concepts/" data-id="cm3n9nnuz0000rzo3gjzp677v" data-title="sui coin 的一些概念 设计思想和练习" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/ability/" rel="tag">ability</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/move/" rel="tag">move</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/sui/" rel="tag">sui</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sui/sui-move-ability" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="2024/11/10/sui/sui-move-ability/" class="article-date">
  <time class="dt-published" datetime="2024-11-09T16:08:11.000Z" itemprop="datePublished">2024-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="categories/sui/">sui</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="2024/11/10/sui/sui-move-ability/">Move 对象的有4种能力(abliity) 设计考虑</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Move-对象的有4种能力-abliity"><a href="#Move-对象的有4种能力-abliity" class="headerlink" title="Move 对象的有4种能力(abliity)"></a>Move 对象的有4种能力(abliity)</h1><h2 id="1-对象的几种存储状态"><a href="#1-对象的几种存储状态" class="headerlink" title="1. 对象的几种存储状态:"></a>1. 对象的几种存储状态:</h2><ul>
<li><p>新建的对象， 进入未曾存储状态，一个交易结束之后，对象要么被销毁，要么被存储到网络的链上存储。</p>
</li>
<li><p>链上存储的对象，也可以借用引用参与交易运算</p>
</li>
<li><p>运行态的对象，可以通过share或freeze 编程共享对象。freeze的对象是只读的。</p>
</li>
<li><p>链上存储对象，可以通过函数调用作为输入参数，移动成运行态，进入运行态之后，又可以重新进入析构或重新存到链上。</p>
</li>
</ul>
<p><img src="images/image-20241114154521620.png" alt="image-20241114154521620"></p>
<h2 id="2-对象具有的四种ability-能力"><a href="#2-对象具有的四种ability-能力" class="headerlink" title="2.  对象具有的四种ability (能力)"></a>2.  对象具有的四种ability (能力)</h2><p>这四种能力是：</p>
<ul>
<li><p><code>copy</code></p>
<ul>
<li>允许复制具有此功能的类型的值。</li>
<li>当赋值或传参数时,会自动拷贝成新对象</li>
<li>如果没有实现copy能力, 赋值的时候,是对象被移动</li>
</ul>
</li>
<li><p><code>drop</code></p>
<ul>
<li>允许跳出作用域自动删除</li>
</ul>
</li>
<li><p><code>store</code></p>
<ul>
<li>允许具有此功能的类型的值存在于 链上中的值中。  存在sui 网络上的对象的字段</li>
<li>对于 Sui，控制对象内部可以存储哪些<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">数据。</a> 还控制哪些类型可以在其定义模块之外传</li>
</ul>
</li>
<li><p><code>key</code></p>
<ul>
<li><p>允许类型用作存储的 “key”。表面上，这意味着该值可以是 存储中的顶级价值;换句话说，它不需要包含在另一个值中，以 在仓库里。</p>
</li>
<li><p>对于 Sui，用于表示<a target="_blank" rel="noopener" href="https://move-book.com/reference/abilities/object.html">对象</a>。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-1-如果有copy能力-赋值就是拷贝成一个新对象"><a href="#2-1-如果有copy能力-赋值就是拷贝成一个新对象" class="headerlink" title="2.1 如果有copy能力,赋值就是拷贝成一个新对象"></a>2.1 如果有copy能力,赋值就是拷贝成一个新对象</h3><p><img src="images/image-20241111194804064.png" alt="image-20241111194804064"></p>
<ul>
<li><p>上图中27行,c对象被拷贝到d,c和d指向的不是同一个对象, </p>
</li>
<li><p>28 行修改了d,但是c没有被修改</p>
</li>
<li><p>32行和33行中,c和d取值不同.</p>
</li>
</ul>
<h3 id="2-2-如果没有copy-能力-赋值就是移动对象"><a href="#2-2-如果没有copy-能力-赋值就是移动对象" class="headerlink" title="2.2 如果没有copy 能力,赋值就是移动对象"></a>2.2 如果没有copy 能力,赋值就是移动对象</h3><p>下面例子中 std::debug::print(&amp;c); 会编译失败，因为 c 对象以及该移动给d了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">NonCopyable</span> &#123;</span><br><span class="line">    value :u64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">test_non_copy</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> c = <span class="title class_">NonCopyable</span>&#123; <span class="attr">value</span>:<span class="number">33</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> d = c ;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;c); <span class="comment">//此时c对象已经被移动给d</span></span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;d);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// sui::test_utils::destroy(c);</span></span><br><span class="line">    <span class="attr">sui</span>::<span class="attr">test_utils</span>::<span class="title function_">destroy</span>(d);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>



<h3 id="2-3-销毁-drop"><a href="#2-3-销毁-drop" class="headerlink" title="2.3  销毁 (drop)"></a>2.3  销毁 (drop)</h3><h4 id="2-3-1-离开作用域自动销毁-需要具有drop能力"><a href="#2-3-1-离开作用域自动销毁-需要具有drop能力" class="headerlink" title="2.3.1 离开作用域自动销毁,需要具有drop能力"></a>2.3.1 离开作用域自动销毁,需要具有drop能力</h4><figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> struct <span class="title class_">IgnoreMe</span> has drop&#123;</span><br><span class="line">    <span class="attr">a</span>:u32,</span><br><span class="line">    <span class="attr">b</span>:u32</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">test_ignore</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> im = <span class="title class_">IgnoreMe</span>&#123;<span class="attr">a</span>:<span class="number">3</span>,<span class="attr">b</span>:<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="title function_">print</span>(&amp;im);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上文定义的IgnoreMe 对象im 具有自动析构的能力<code>has drop</code>,在离开函数的作用域时候自动析构.</p>
<h3 id="2-3-2-没有drop能力的对象需要主动析构或保存到链上"><a href="#2-3-2-没有drop能力的对象需要主动析构或保存到链上" class="headerlink" title="2.3.2 没有drop能力的对象需要主动析构或保存到链上"></a>2.3.2 没有drop能力的对象需要主动析构或保存到链上</h3> <figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">NoDrop</span>&#123; value :u64 &#125;</span><br><span class="line"></span><br><span class="line"> #[test]</span><br><span class="line"> fun <span class="title function_">test_nodrop</span>(<span class="params"></span>)&#123;</span><br><span class="line">     <span class="keyword">let</span> no_drop = <span class="title class_">NoDrop</span>&#123; value :<span class="number">34</span>&#125;;</span><br><span class="line">     <span class="title function_">print</span>(&amp;no_drop);</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">let</span> <span class="title class_">NoDrop</span>&#123; <span class="attr">value</span>: _ &#125; = no_drop;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这个例子 NoDrop类型没有drop能力,对象离开作用域,需要析构,或者将对象的所有权转移.</p>
<ul>
<li>第8行是析构对象的代码</li>
</ul>
<h3 id="2-3-4-不能析构时-能转移所有权"><a href="#2-3-4-不能析构时-能转移所有权" class="headerlink" title="2.3.4  不能析构时,能转移所有权:"></a>2.3.4  不能析构时,能转移所有权:</h3> <figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fun <span class="title function_">useNoDrop</span>(o : <span class="title class_">NoDrop</span> ) : <span class="title class_">NoDrop</span>&#123;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;o);</span><br><span class="line">    o</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">testUseNoDrop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> o = <span class="title class_">NoDrop</span>&#123;value :<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="title function_">useNoDrop</span>(o);</span><br><span class="line">    <span class="title class_">NoDrop</span>&#123;<span class="attr">value</span>:_&#125; = d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第1行函数UseNoDrop获得了对象o</li>
<li>第3行,函数将N哦Drop对象o 返回出去,将所有权转移出去.</li>
<li>第10 行,显示代码析构这个NoDrop对象</li>
</ul>
<h3 id="2-3-5-独立存储在链上"><a href="#2-3-5-独立存储在链上" class="headerlink" title="2.3.5  独立存储在链上"></a>2.3.5  独立存储在链上</h3><p>对象独立存储在链上,必须具有key能力 <code>has key</code></p>
<p><img src="images/image-20241114085958845.png" alt="image-20241114085958845"></p>
<figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">Keyable</span> has key&#123;</span><br><span class="line">    id : <span class="variable constant_">UID</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fun <span class="title function_">test_key</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> mut ctx = tx_context ::<span class="title function_">dummy</span>();</span><br><span class="line">    <span class="keyword">let</span> k = <span class="title class_">Keyable</span>&#123; <span class="attr">id</span>: <span class="attr">object</span>::<span class="title function_">new</span>(&amp;mut ctx)&#125;;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;k);</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">transfer</span>(k,ctx.<span class="title function_">sender</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子中Keyable是具有key能力的,可以通过transfer传递到sui网络上存储, 指定owner地址.</p>
<h3 id="2-3-6-对象作为-共享对象存储在链上-需要具有key能力"><a href="#2-3-6-对象作为-共享对象存储在链上-需要具有key能力" class="headerlink" title="2.3.6   对象作为 共享对象存储在链上,需要具有key能力"></a>2.3.6   对象作为 共享对象存储在链上,需要具有key能力</h3><p><img src="images/image-20241114091033160.png" alt="image-20241114091033160"></p>
<h5 id><a href="#" class="headerlink" title></a></h5><h3 id="2-3-7-对象作为一个对象的一部分存储-需要具有store能力"><a href="#2-3-7-对象作为一个对象的一部分存储-需要具有store能力" class="headerlink" title="2.3.7 对象作为一个对象的一部分存储,需要具有store能力"></a>2.3.7 对象作为一个对象的一部分存储,需要具有store能力</h3><figure class="highlight ts"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">use <span class="attr">std</span>::<span class="attr">string</span>::<span class="title class_">String</span>;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Grandson</span> has store&#123;</span><br><span class="line">    name : <span class="title class_">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Child</span> has store&#123;</span><br><span class="line">    name : <span class="title class_">String</span>,</span><br><span class="line">    child : <span class="title class_">Grandson</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> struct <span class="title class_">Parent</span> has key&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="variable constant_">UID</span>,</span><br><span class="line">    <span class="attr">child</span>: <span class="title class_">Child</span>,</span><br><span class="line">&#125;</span><br><span class="line">#[test]</span><br><span class="line">fun  <span class="title function_">test_store_child</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> mut ctx = <span class="attr">tx_context</span>::<span class="title function_">dummy</span>();</span><br><span class="line">    <span class="keyword">let</span> foo = <span class="title class_">Parent</span> &#123;</span><br><span class="line">        id : <span class="attr">object</span>::<span class="title function_">new</span>(&amp;mut ctx),</span><br><span class="line">        <span class="attr">child</span>: <span class="title class_">Child</span> &#123;</span><br><span class="line">            name : b<span class="string">&quot;one child&quot;</span>.<span class="title function_">to_string</span>(),</span><br><span class="line">            <span class="attr">child</span>: <span class="title class_">Grandson</span>&#123;</span><br><span class="line">                name : b<span class="string">&quot;a grandson&quot;</span>.<span class="title function_">to_string</span>(),</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="attr">std</span>::<span class="attr">debug</span>::<span class="title function_">print</span>(&amp;foo);</span><br><span class="line">    <span class="attr">transfer</span>::<span class="title function_">freeze_object</span>(foo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Parent是独立存储,具有key能力</p>
</li>
<li><p>Child 都是作为独立存储对象Parent的字段</p>
</li>
<li><p>Grandson 作为Child的字段存储在链上,</p>
</li>
<li><p>Child 和Grandson 都具有store能力</p>
</li>
</ul>
<p><img src="images/image-20241114095326972.png" alt="image-20241114095326972"></p>
<h3 id="2-3-8-无ablity-对象就必须在module内提供方法去析构它"><a href="#2-3-8-无ablity-对象就必须在module内提供方法去析构它" class="headerlink" title="2.3.8 无ablity 对象就必须在module内提供方法去析构它"></a>2.3.8 无ablity 对象就必须在module内提供方法去析构它</h3><ul>
<li><p>一个对象,没有任何ability ,就是hot potato</p>
</li>
<li><p>没有key 和store 无法保存在链上</p>
</li>
<li><p>没有drop 不会自动析构</p>
</li>
<li><p>只能在本模块析构, 因为外部模块无法直接访问struct的字段</p>
</li>
<li><p>下图中模块A, 需要使用模块B中的Foo 对象,使用完毕需要调用模块B 的析构方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> struct <span class="title class_">Foo</span> &#123;</span><br><span class="line">    value :u32</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-8-1-根据对象不能外部析构的特性-构造借贷模型"><a href="#2-3-8-1-根据对象不能外部析构的特性-构造借贷模型" class="headerlink" title="2.3.8.1 根据对象不能外部析构的特性,构造借贷模型"></a>2.3.8.1 根据对象不能外部析构的特性,构造借贷模型</h4><p><img src="images/image-20241114080921239.png" alt="image-20241114080921239"></p>
<h4 id="2-3-8-2-闪电贷的逻辑"><a href="#2-3-8-2-闪电贷的逻辑" class="headerlink" title="2.3.8.2 闪电贷的逻辑"></a>2.3.8.2 闪电贷的逻辑</h4><p><img src="images/image-20241111213310276.png" alt="image-20241111213310276"></p>
<ul>
<li>定义闪电贷的出借方,在borrow的时候获得Coin和 Loan对象,  </li>
<li>在repay的时候才能销毁Loan对象, 如果借出放不调用repay,无法销毁Loan对象,交易会回滚.</li>
<li>replay的时候需要校验传入的coin 要多于borrow的coin, 多出来的部分作为回报.<ul>
<li>下面是 贷方代码的例子</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> book::loan;</span><br><span class="line"><span class="comment">//hot potato pattern</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Loan</span>&#123;</span><br><span class="line">    feedback: u64, <span class="comment">//还钱数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">Coin</span> has key,store&#123;</span><br><span class="line">	id:UID,</span><br><span class="line">	amount:u64</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//借出钱</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">borrow</span><span class="params">(amount:u64,ctx:&amp;mut TxContext)</span> :(Coin,Loan)&#123;</span></span><br><span class="line">	let feedback = amount * <span class="number">103</span> /<span class="number">100</span>;</span><br><span class="line">	let c = Coin&#123; id: object::<span class="built_in">new</span>(ctx),amount&#125;;</span><br><span class="line">	(c, Loan&#123;feedback&#125;) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> ErrNotEnoughFeedback:u64 = <span class="number">43</span>;</span><br><span class="line"><span class="type">const</span> OWNER_ADDR :address = @<span class="number">0xafe36044ef56d22494bfe6231e78dd128f097693f2d974761ee4d649e61f5fa2</span>;<span class="comment">//todo</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> fun <span class="title">repay</span><span class="params">(coin: Coin,loan:Loan)</span></span>&#123;</span><br><span class="line">	assert!(coin.amount &gt;= loan.feedback,ErrNotEnoughFeedback);</span><br><span class="line">	transfer::<span class="built_in">public_transfer</span>(coin,OWNER_ADDR);</span><br><span class="line">	Loan&#123; feedback:_&#125; = loan;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">``` &#123;.line-numbers&#125;</span><br><span class="line"></span><br><span class="line">下面是借方模块的代码,使用测试代码演示</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line">#[test_only]</span><br><span class="line"><span class="keyword">module</span> book::test_loan;</span><br><span class="line">use book::loan::Coin;</span><br><span class="line"></span><br><span class="line"><span class="comment">////todo 贷款后赚钱的业务逻辑,这里没有实现</span></span><br><span class="line"><span class="function">fun <span class="title">earn_money</span><span class="params">(coin : Coin )</span> :Coin&#123;</span></span><br><span class="line">    coin</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">#[<span class="built_in">expected_failure</span>(abort_code=book::loan::ErrNotEnoughFeedback)]</span><br><span class="line"><span class="function">fun <span class="title">borrow_test</span><span class="params">()</span></span>&#123;</span><br><span class="line">	let mut ctx = tx_context::<span class="built_in">dummy</span>();</span><br><span class="line">	<span class="built_in">let</span> (coin,loan) = book::loan::<span class="built_in">borrow</span>(<span class="number">233</span>,&amp;mut ctx);</span><br><span class="line">	let new_money = <span class="built_in">earn_money</span>(coin);</span><br><span class="line">	book::loan::<span class="built_in">repay</span>(new_money,loan);</span><br><span class="line">	<span class="comment">//todo 赚钱了，可以把feedback-amount 的钱，存入自己钱包</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-10-key-store-ability"><a href="#2-3-10-key-store-ability" class="headerlink" title="2.3.10 key + store ability"></a>2.3.10 key + store ability</h3><p>目前其他模块存到链上的对象,都需要key+store能力</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> fun <span class="built_in">public_transfer</span>&lt;T: key + store&gt;(obj: T, recipient: address) &#123;</span><br><span class="line">    <span class="built_in">transfer_impl</span>(obj, recipient)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> fun <span class="built_in">public_freeze_object</span>&lt;T: key + store&gt;(obj: T) &#123;</span><br><span class="line">    <span class="built_in">freeze_object_impl</span>(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> fun <span class="built_in">public_share_object</span>&lt;T: key + store&gt;(obj: T) &#123;</span><br><span class="line">    <span class="built_in">share_object_impl</span>(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="附录"><a href="#附录" class="headerlink" title="附录:"></a>附录:</h1><p>最近在参加HOH 共学活动,</p>
<p>💧 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/d0brr-ao6cZ5t8Z5OO1Mog">HOH水分子公众号</a></p>
<p>🌊 <a target="_blank" rel="noopener" href="https://x.com/0xHOH">HOH水分子X账号</a></p>
<p>📹 <a target="_blank" rel="noopener" href="https://space.bilibili.com/3493269495352098">课程B站账号</a></p>
<p>💻 Github仓库 <a target="_blank" rel="noopener" href="https://github.com/move-cn/letsmove">https://github.com/move-cn/letsmove</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.walrus.mov/2024/11/10/sui/sui-move-ability/" data-id="cm3n9nnv10001rzo3cy8e3oes" data-title="Move 对象的有4种能力(abliity) 设计考虑" class="article-share-link"><span class="fa fa-share">Compartir</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/ability/" rel="tag">ability</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/move/" rel="tag">move</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/sui/" rel="tag">sui</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categorías</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="categories/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="categories/hexo/dns/">dns</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="categories/sui/">sui</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="tags/ability/" rel="tag">ability</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/dns/" rel="tag">dns</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/github-page/" rel="tag">github page</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/move/" rel="tag">move</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/package-upgrade/" rel="tag">package upgrade</a></li><li class="tag-list-item"><a class="tag-list-link" href="tags/sui/" rel="tag">sui</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nube de Tags</h3>
    <div class="widget tagcloud">
      <a href="tags/ability/" style="font-size: 15px;">ability</a> <a href="tags/blog/" style="font-size: 10px;">blog</a> <a href="tags/dns/" style="font-size: 10px;">dns</a> <a href="tags/github-page/" style="font-size: 10px;">github page</a> <a href="tags/move/" style="font-size: 20px;">move</a> <a href="tags/package-upgrade/" style="font-size: 10px;">package upgrade</a> <a href="tags/sui/" style="font-size: 20px;">sui</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archivos</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="archives/2024/11/">November 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Posts recientes</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="2024/11/23/sui/sui%20witness/">(no title)</a>
          </li>
        
          <li>
            <a href="2024/11/19/walrus/walrus-first/">(no title)</a>
          </li>
        
          <li>
            <a href="2024/11/19/hexo-install-tips/">使用hexo搭建个人主页</a>
          </li>
        
          <li>
            <a href="2024/11/18/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="2024/11/11/sui/sui-colearn-qa1/">2024 -11-11  第一周Sui Move训练营课程答疑问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 nextuser<br>
      Construido por <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="js/jquery-3.6.4.min.js"></script>



  
<script src="fancybox/jquery.fancybox.min.js"></script>




<script src="js/script.js"></script>





  </div>
</body>
</html>